
<!DOCTYPE html>
<html lang="en" class="">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8" />
<link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/github-d0dea0e5376d5c42aabf467726e0cffb7034a0d94eb947b9328eb6c9c4fcbba3.css" media="all" rel="stylesheet" />
<link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/github2-5f7255544b25f937224217b1c37ee5c139a0a00a3decd8020b9aabc550340903.css" media="all" rel="stylesheet" />
<link as="script" href="https://assets-cdn.github.com/assets/frameworks-9ee55ceaf87fc34dc86334249fef6cbece88e815478e0fbe81642d57ed0fff89.js" rel="preload" />
<link as="script" href="https://assets-cdn.github.com/assets/github-8afeb971202f92778ffc73ddd92661c1977dc5e42a928ed35f8ec96e425a6e7a.js" rel="preload" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Language" content="en" />
<meta name="viewport" content="width=1020" />
<title>pre, post middleware are not executed on findByIdAndUpdate · Issue #964 · Automattic/mongoose · GitHub</title>
<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub" />
<link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
<link rel="apple-touch-icon" href="http://github.com/apple-touch-icon.png" />
<link rel="apple-touch-icon" sizes="57x57" href="http://github.com/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="http://github.com/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="http://github.com/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="http://github.com/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="http://github.com/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="http://github.com/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="http://github.com/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="http://github.com/apple-touch-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="http://github.com/apple-touch-icon-180x180.png" />
<meta property="fb:app_id" content="1401488693436528" />
<meta content="https://avatars0.githubusercontent.com/u/1432812?v=3&amp;s=400" name="twitter:image:src" /><meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="pre, post middleware are not executed on findByIdAndUpdate · Issue #964 · Automattic/mongoose" name="twitter:title" /><meta content="Because a findAndUpdate method is presented to cut down the following code:

 Model.findById(_id, function (err, doc) {
      if (doc) {
          doc.field = 'value';
          doc.save(function (..." name="twitter:description" />
<meta content="https://avatars0.githubusercontent.com/u/1432812?v=3&amp;s=400" property="og:image" /><meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="pre, post middleware are not executed on findByIdAndUpdate · Issue #964 · Automattic/mongoose" property="og:title" /><meta content="https://github.com/Automattic/mongoose/issues/964" property="og:url" /><meta content="Because a findAndUpdate method is presented to cut down the following code:

 Model.findById(_id, function (err, doc) {
      if (doc) {
          doc.field = 'value';
          doc.save(function (..." property="og:description" />
<meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats" />
<meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors" />
<link rel="assets" href="https://assets-cdn.github.com/" />
<meta name="pjax-timeout" content="1000" />
<meta name="msapplication-TileImage" content="/windows-tile.png" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="selected-link" value="repo_issues" data-pjax-transient="data-pjax-transient" />
<meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" />
<meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA" />
<meta name="google-analytics" content="UA-3769691-2" />
<meta content="collector.githubapp.com" name="octolytics-host" /><meta content="github" name="octolytics-app-id" /><meta content="68C5BF7F:1B9E:7AF9ACB:56ADB9EC" name="octolytics-dimension-request_id" />
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/issues/show" data-pjax-transient="true" name="analytics-location" />
<meta class="js-ga-set" name="dimension1" content="Logged Out" />
<meta name="hostname" content="github.com" />
<meta name="user-login" content="" />
<meta name="expected-hostname" content="github.com" />
<link rel="mask-icon" href="https://assets-cdn.github.com/pinned-octocat.svg" color="#4078c0" />
<link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico" />
<meta content="a5d0a6f6cb8a0541625d54de19acbf24e139efa0" name="form-nonce" />
<meta http-equiv="x-pjax-version" content="55b41dd856d04e698e17bd7fc2020079" />
<meta name="description" content="mongoose - MongoDB object modeling designed to work in an asynchronous environment." />
<meta name="go-import" content="github.com/Automattic/mongoose git https://github.com/Automattic/mongoose.git" />
<meta content="887802" name="octolytics-dimension-user_id" /><meta content="Automattic" name="octolytics-dimension-user_login" /><meta content="597879" name="octolytics-dimension-repository_id" /><meta content="Automattic/mongoose" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="597879" name="octolytics-dimension-repository_network_root_id" /><meta content="Automattic/mongoose" name="octolytics-dimension-repository_network_root_nwo" />
<link href="https://github.com/Automattic/mongoose/commits/master.atom" rel="alternate" title="Recent Commits to mongoose:master" type="application/atom+xml" />
</head>
<body class="logged_out   env-production  vis-public">
<a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
<div class="header header-logged-out" role="banner">
<div class="container clearfix">
<a class="header-logo-wordmark" href="https://github.com/" data-ga-click="(Logged out) Header, go to homepage, icon:logo-wordmark">
<span aria-hidden="true" class="mega-octicon octicon-logo-github"></span>
</a>
<div class="header-actions" role="navigation">
<a class="btn btn-primary" href="http://github.com/join?source=header-repo" data-ga-click="(Logged out) Header, clicked Sign up, text:sign-up">Sign up</a>
<a class="btn" href="http://github.com/login?return_to=%2FAutomattic%2Fmongoose%2Fissues%2F964" data-ga-click="(Logged out) Header, clicked Sign in, text:sign-in">Sign in</a>
</div>
<div class="site-search repo-scope js-site-search" role="search">
<!-- &lt;/textarea&gt; --><!-- '"` --><form accept-charset="UTF-8" action="/Automattic/mongoose/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/Automattic/mongoose/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓" /></div>
<label class="js-chromeless-input-container form-control">
<div class="scope-badge">This repository</div>
<input type="text" class="js-site-search-focus js-site-search-field is-clearable chromeless-input" data-hotkey="s" name="q" placeholder="Search" aria-label="Search this repository" data-global-scope-placeholder="Search GitHub" data-repo-scope-placeholder="Search" tabindex="1" autocapitalize="off" />
</label>
</form>
</div>
<ul class="header-nav left" role="navigation">
<li class="header-nav-item">
<a class="header-nav-link" href="http://github.com/explore" data-ga-click="(Logged out) Header, go to explore, text:explore">Explore</a>
</li>
<li class="header-nav-item">
<a class="header-nav-link" href="http://github.com/features" data-ga-click="(Logged out) Header, go to features, text:features">Features</a>
</li>
<li class="header-nav-item">
<a class="header-nav-link" href="https://enterprise.github.com/" data-ga-click="(Logged out) Header, go to enterprise, text:enterprise">Enterprise</a>
</li>
<li class="header-nav-item">
<a class="header-nav-link" href="http://github.com/pricing" data-ga-click="(Logged out) Header, go to pricing, text:pricing">Pricing</a>
</li>
</ul>
</div>
</div>
<div id="start-of-content" class="accessibility-aid"></div>
<div id="js-flash-container">
</div>
<div role="main" class="main-content">
<div itemscope="itemscope" itemtype="http://schema.org/WebPage">
<div id="js-repo-pjax-container" class="context-loader-container js-repo-nav-next" data-pjax-container="data-pjax-container">
<div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav">
<div class="container repohead-details-container">
<ul class="pagehead-actions">
<li>
<a href="http://github.com/login?return_to=%2FAutomattic%2Fmongoose" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to watch a repository" rel="nofollow">
<span aria-hidden="true" class="octicon octicon-eye"></span>
    Watch
  </a>
<a class="social-count" href="http://github.com/Automattic/mongoose/watchers">
    471
  </a>
</li>
<li>
<a href="http://github.com/login?return_to=%2FAutomattic%2Fmongoose" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to star a repository" rel="nofollow">
<span aria-hidden="true" class="octicon octicon-star"></span>
    Star
  </a>
<a class="social-count js-social-count" href="http://github.com/Automattic/mongoose/stargazers">
      8,570
    </a>
</li>
<li>
<a href="http://github.com/login?return_to=%2FAutomattic%2Fmongoose" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to fork a repository" rel="nofollow">
<span aria-hidden="true" class="octicon octicon-repo-forked"></span>
        Fork
      </a>
<a href="http://github.com/Automattic/mongoose/network" class="social-count">
      1,354
    </a>
</li>
</ul>
<h1 itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public ">
<span aria-hidden="true" class="octicon octicon-repo"></span>
<span class="author"><a href="http://github.com/Automattic" class="url fn" itemprop="url" rel="author"><span itemprop="title">Automattic</span></a></span><!--
--><span class="path-divider">/</span><!--
--><strong><a href="http://github.com/Automattic/mongoose" data-pjax="#js-repo-pjax-container">mongoose</a></strong>
<span class="page-context-loader">
<img alt="" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
</span>
</h1>
</div>
<div class="container">
<nav class="reponav js-repo-nav js-sidenav-container-pjax js-octicon-loaders" role="navigation" data-pjax="#js-repo-pjax-container">
<a href="http://github.com/Automattic/mongoose" aria-label="Code" class="js-selected-navigation-item reponav-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /Automattic/mongoose">
<span aria-hidden="true" class="octicon octicon-code"></span>
    Code
</a>
<a href="http://github.com/Automattic/mongoose/issues" aria-selected="true" class="js-selected-navigation-item selected reponav-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /Automattic/mongoose/issues">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
      Issues
      <span class="counter">431</span>
</a>
<a href="http://github.com/Automattic/mongoose/pulls" class="js-selected-navigation-item reponav-item" data-hotkey="g p" data-selected-links="repo_pulls /Automattic/mongoose/pulls">
<span aria-hidden="true" class="octicon octicon-git-pull-request"></span>
    Pull requests
    <span class="counter">8</span>
</a>
<a href="http://github.com/Automattic/mongoose/wiki" class="js-selected-navigation-item reponav-item" data-hotkey="g w" data-selected-links="repo_wiki /Automattic/mongoose/wiki">
<span aria-hidden="true" class="octicon octicon-book"></span>
      Wiki
</a>
<a href="http://github.com/Automattic/mongoose/pulse" class="js-selected-navigation-item reponav-item" data-selected-links="pulse /Automattic/mongoose/pulse">
<span aria-hidden="true" class="octicon octicon-pulse"></span>
    Pulse
</a>
<a href="http://github.com/Automattic/mongoose/graphs" class="js-selected-navigation-item reponav-item" data-selected-links="repo_graphs repo_contributors /Automattic/mongoose/graphs">
<span aria-hidden="true" class="octicon octicon-graph"></span>
    Graphs
</a>
</nav>
</div>
</div>
<div class="container new-discussion-timeline experiment-repo-nav">
<div class="repository-content">
<style type="text/css" media="screen">
  span.labelstyle-eb6420, .linked-labelstyle-eb6420 {  background-color: #eb6420 !important;  color: #fff !important;}.labelstyle-eb6420.selected {  background-color: #eb6420 !important;  color: #fff !important;}.label-select-menu .labelstyle-eb6420.selected {  background:rgba(235, 100, 32, 0.12) !important;  color: #994114 !important;}

span.labelstyle-d7e102, .linked-labelstyle-d7e102 {  background-color: #d7e102 !important;  color: #303300 !important;}.labelstyle-d7e102.selected {  background-color: #d7e102 !important;  color: #303300 !important;}.label-select-menu .labelstyle-d7e102.selected {  background:rgba(215, 225, 2, 0.12) !important;  color: #929901 !important;}

span.labelstyle-bfdadc, .linked-labelstyle-bfdadc {  background-color: #bfdadc !important;  color: #2c3233 !important;}.labelstyle-bfdadc.selected {  background-color: #bfdadc !important;  color: #2c3233 !important;}.label-select-menu .labelstyle-bfdadc.selected {  background:rgba(191, 218, 220, 0.12) !important;  color: #849799 !important;}

span.labelstyle-e10c02, .linked-labelstyle-e10c02 {  background-color: #e10c02 !important;  color: #fff !important;}.labelstyle-e10c02.selected {  background-color: #e10c02 !important;  color: #fff !important;}.label-select-menu .labelstyle-e10c02.selected {  background:rgba(225, 12, 2, 0.12) !important;  color: #990801 !important;}

span.labelstyle-d4c5f9, .linked-labelstyle-d4c5f9 {  background-color: #d4c5f9 !important;  color: #2b2833 !important;}.labelstyle-d4c5f9.selected {  background-color: #d4c5f9 !important;  color: #2b2833 !important;}.label-select-menu .labelstyle-d4c5f9.selected {  background:rgba(212, 197, 249, 0.12) !important;  color: #827999 !important;}

span.labelstyle-444444, .linked-labelstyle-444444 {  background-color: #444444 !important;  color: #fff !important;}.labelstyle-444444.selected {  background-color: #444444 !important;  color: #fff !important;}.label-select-menu .labelstyle-444444.selected {  background:rgba(68, 68, 68, 0.12) !important;  color: #999999 !important;}

span.labelstyle-02d7e1, .linked-labelstyle-02d7e1 {  background-color: #02d7e1 !important;  color: #003033 !important;}.labelstyle-02d7e1.selected {  background-color: #02d7e1 !important;  color: #003033 !important;}.label-select-menu .labelstyle-02d7e1.selected {  background:rgba(2, 215, 225, 0.12) !important;  color: #019299 !important;}

span.labelstyle-0052cc, .linked-labelstyle-0052cc {  background-color: #0052cc !important;  color: #fff !important;}.labelstyle-0052cc.selected {  background-color: #0052cc !important;  color: #fff !important;}.label-select-menu .labelstyle-0052cc.selected {  background:rgba(0, 82, 204, 0.12) !important;  color: #003d99 !important;}

span.labelstyle-bfe5bf, .linked-labelstyle-bfe5bf {  background-color: #bfe5bf !important;  color: #2a332a !important;}.labelstyle-bfe5bf.selected {  background-color: #bfe5bf !important;  color: #2a332a !important;}.label-select-menu .labelstyle-bfe5bf.selected {  background:rgba(191, 229, 191, 0.12) !important;  color: #7f997f !important;}

span.labelstyle-FFFFFF, .linked-labelstyle-FFFFFF {  background-color: #FFFFFF !important;  color: #333333 !important;}.labelstyle-FFFFFF.selected {  background-color: #FFFFFF !important;  color: #333333 !important;}.label-select-menu .labelstyle-FFFFFF.selected {  background:rgba(255, 255, 255, 0.12) !important;  color: #999999 !important;}

span.labelstyle-e102d8, .linked-labelstyle-e102d8 {  background-color: #e102d8 !important;  color: #fff !important;}.labelstyle-e102d8.selected {  background-color: #e102d8 !important;  color: #fff !important;}.label-select-menu .labelstyle-e102d8.selected {  background:rgba(225, 2, 216, 0.12) !important;  color: #990192 !important;}

span.labelstyle-DDDDDD, .linked-labelstyle-DDDDDD {  background-color: #DDDDDD !important;  color: #333333 !important;}.labelstyle-DDDDDD.selected {  background-color: #DDDDDD !important;  color: #333333 !important;}.label-select-menu .labelstyle-DDDDDD.selected {  background:rgba(221, 221, 221, 0.12) !important;  color: #999999 !important;}

span.labelstyle-5319e7, .linked-labelstyle-5319e7 {  background-color: #5319e7 !important;  color: #fff !important;}.labelstyle-5319e7.selected {  background-color: #5319e7 !important;  color: #fff !important;}.label-select-menu .labelstyle-5319e7.selected {  background:rgba(83, 25, 231, 0.12) !important;  color: #361099 !important;}

span.labelstyle-02e10c, .linked-labelstyle-02e10c {  background-color: #02e10c !important;  color: #fff !important;}.labelstyle-02e10c.selected {  background-color: #02e10c !important;  color: #fff !important;}.label-select-menu .labelstyle-02e10c.selected {  background:rgba(2, 225, 12, 0.12) !important;  color: #019908 !important;}

span.labelstyle-006b75, .linked-labelstyle-006b75 {  background-color: #006b75 !important;  color: #fff !important;}.labelstyle-006b75.selected {  background-color: #006b75 !important;  color: #fff !important;}.label-select-menu .labelstyle-006b75.selected {  background:rgba(0, 107, 117, 0.12) !important;  color: #008b99 !important;}
</style>
<div class="issues-listing" data-pjax="data-pjax">
<div class="context-loader large-format-loader">
<p><img alt="" height="64" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-128.gif" width="64" /></p>
<p>Loading…</p>
</div>
<div id="show_issue" class="js-issues-results">
<div id="partial-discussion-header" class="gh-header js-details-container js-socket-channel js-updatable-content issue" data-channel="Automattic/mongoose:issue:5097952" data-url="/Automattic/mongoose/issues/964/show_partial?partial=issues%2Ftitle">
<div class="gh-header-show ">
<div class="gh-header-actions">
<a href="http://github.com/Automattic/mongoose/issues/new" class="btn btn-sm btn-primary right" data-hotkey="c">
            New issue
          </a>
</div>
<h1 class="gh-header-title">
<span class="js-issue-title">pre, post middleware are not executed on findByIdAndUpdate</span>
<span class="gh-header-number">#964</span>
</h1>
</div>
<div class="flex-table gh-header-meta">
<div class="flex-table-item">
<div class="state state-closed">
<span aria-hidden="true" class="octicon octicon-issue-closed"></span>
          Closed
        </div>
</div>
<div class="flex-table-item flex-table-item-primary">
<a href="http://github.com/skotchio" class="author">skotchio</a> opened this <span class="noun">Issue</span> <time datetime="2012-06-15T18:32:26Z" is="relative-time">Jun 15, 2012</time>
        &middot; 74 comments
    </div>
</div>
</div>
<div id="discussion_bucket" class="tab-content clearfix">
<div id="partial-discussion-sidebar" class="discussion-sidebar js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:issue:5097952" data-url="/Automattic/mongoose/issues/964/show_partial?partial=issues%2Fsidebar">
<div class="discussion-sidebar-item sidebar-labels js-discussion-sidebar-item">
<!-- &lt;/textarea&gt; --><!-- '"` --><form accept-charset="UTF-8" action="/Automattic/mongoose/issues/964?partial=issues%2Fsidebar%2Fshow%2Flabels" class="js-issue-sidebar-form" data-form-nonce="a5d0a6f6cb8a0541625d54de19acbf24e139efa0" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="4rbg7SlCrv5RWIdv7bqxDi6mPEnT2tCsKBxwYTLaZsMcXdKg4em7bOCAXGOhBSIxGZXoRpi2hW9JOWOm1Fd+7Q==" /></div>
<h3 class="discussion-sidebar-heading">
    Labels
  </h3>
<div class="labels css-truncate">
    None yet
</div>
</form></div>
<div class="discussion-sidebar-item sidebar-milestone js-discussion-sidebar-item">
<!-- &lt;/textarea&gt; --><!-- '"` --><form accept-charset="UTF-8" action="/Automattic/mongoose/issues/964/set_milestone?partial=issues%2Fsidebar%2Fshow%2Fmilestone" class="js-issue-sidebar-form" data-form-nonce="a5d0a6f6cb8a0541625d54de19acbf24e139efa0" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="s42/a6z492ZI7rRZOd/u/AhZ0YrJ7R4lSX/sU+NUGh2WLXg3j5UWArXPwRhWUoptg6P2E948TcsGMNCo1HaOoA==" /></div>
<h3 class="discussion-sidebar-heading">
    Milestone
  </h3>


      No milestone

</form></div>
<div class="discussion-sidebar-item sidebar-assignee js-discussion-sidebar-item">
<!-- &lt;/textarea&gt; --><!-- '"` --><form accept-charset="UTF-8" action="/Automattic/mongoose/issues/964?partial=issues%2Fsidebar%2Fshow%2Fassignee" class="js-issue-sidebar-form" data-form-nonce="a5d0a6f6cb8a0541625d54de19acbf24e139efa0" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="KjHDJmRWfarK0oL0k/Dk/RAHbsW/CRy7t87ZRCKRnXleiJmE6ao4V9ACGlx27j+nHK7sdj5vq/WwKIENHYIhXg==" /></div>
<h3 class="discussion-sidebar-heading">
    Assignee
  </h3>
<span class="css-truncate">
      No one assigned
</span>
</form></div>
<div id="partial-users-participants" class="discussion-sidebar-item">
<div class="participation">
<h3 class="discussion-sidebar-heading">
      28 participants
    </h3>
<div class="participation-avatars">
<a class="participant-avatar tooltipped tooltipped-s" aria-label="skotchio" href="http://github.com/skotchio"><img alt="@skotchio" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/1432812?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="aheckmann" href="http://github.com/aheckmann"><img alt="@aheckmann" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/166834?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="jessefulton" href="http://github.com/jessefulton"><img alt="@jessefulton" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/40847?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="sstadelman" href="http://github.com/sstadelman"><img alt="@sstadelman" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/377404?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="albanm" href="http://github.com/albanm"><img alt="@albanm" class="avatar" height="20" src="https://avatars3.githubusercontent.com/u/164958?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="beetaa" href="http://github.com/beetaa"><img alt="@beetaa" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/5688224?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="joafeldmann" href="http://github.com/joafeldmann"><img alt="@joafeldmann" class="avatar" height="20" src="https://avatars3.githubusercontent.com/u/1437079?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="sunfuze" href="http://github.com/sunfuze"><img alt="@sunfuze" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/1171762?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="perok" href="http://github.com/perok"><img alt="@perok" class="avatar" height="20" src="https://avatars1.githubusercontent.com/u/1502013?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="ludwiksh" href="http://github.com/ludwiksh"><img alt="@ludwiksh" class="avatar" height="20" src="https://avatars3.githubusercontent.com/u/3131349?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="cebor" href="http://github.com/cebor"><img alt="@cebor" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/1576120?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="syzer" href="http://github.com/syzer"><img alt="@syzer" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/1989646?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="askhogan" href="http://github.com/askhogan"><img alt="@askhogan" class="avatar" height="20" src="https://avatars1.githubusercontent.com/u/635449?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="roymap" href="http://github.com/roymap"><img alt="@roymap" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/201791?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="sailxjx" href="http://github.com/sailxjx"><img alt="@sailxjx" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/909853?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="asinha08" href="http://github.com/asinha08"><img alt="@asinha08" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/604180?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="joerx" href="http://github.com/joerx"><img alt="@joerx" class="avatar" height="20" src="https://avatars1.githubusercontent.com/u/1712460?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="vkarpov15" href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="avatar" height="20" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="theGlenn" href="http://github.com/theGlenn"><img alt="@theGlenn" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/3216616?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="krzysztofantczak" href="http://github.com/krzysztofantczak"><img alt="@krzysztofantczak" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/2803248?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="karlstanton" href="http://github.com/karlstanton"><img alt="@karlstanton" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/302968?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="neverfox" href="http://github.com/neverfox"><img alt="@neverfox" class="avatar" height="20" src="https://avatars3.githubusercontent.com/u/3344033?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="CaptainStaplerz" href="http://github.com/CaptainStaplerz"><img alt="@CaptainStaplerz" class="avatar" height="20" src="https://avatars3.githubusercontent.com/u/11563478?v=3&amp;s=40" width="20" /> </a>
<a class="participant-avatar tooltipped tooltipped-s" aria-label="honitus" href="http://github.com/honitus"><img alt="@honitus" class="avatar" height="20" src="https://avatars0.githubusercontent.com/u/11481768?v=3&amp;s=40" width="20" /> </a>
<span class="participation-more">and others</span>
</div>
</div>
</div>
</div>
<div class="discussion-timeline js-quote-selection-container ">
<div class="js-discussion js-socket-channel" data-channel="Automattic/mongoose:marked-as-read:5097952">
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/skotchio"><img alt="@skotchio" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/1432812?v=3&amp;s=96" width="48" /></a>
<div id="issue-5097952" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="2e0eb7edeb2e2e994631e3856f05e585">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/skotchio" class="author">skotchio</a>
</strong>

    commented

    <a href="#issue-5097952" class="timestamp">
<time datetime="2012-06-15T18:32:26Z" is="relative-time">Jun 15, 2012</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Because a findAndUpdate method is presented to cut down the following code:</p>
<pre><code> Model.findById(_id, function (err, doc) {
      if (doc) {
          doc.field = 'value';
          doc.save(function (err) {
                 // do something;
          });
      }
 });
</code></pre>
<p>to this:</p>
<pre><code>Model
   .findByIdAndUpdate(_id, {$set: {field: 'value'}}, function (err, doc) {
        // do something 
    });
</code></pre>
<p>We need to use pre, post middleware exactly the same. At now pre, post middleware are not executed when I make findByIdAndUpdate.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/aheckmann"><img alt="@aheckmann" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/166834?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-6363671" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="3a98ea9360a8b4d339a6d53a9c39819f">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/aheckmann" class="author">aheckmann</a>
</strong>

    commented

    <a href="#issuecomment-6363671" class="timestamp">
<time datetime="2012-06-15T18:44:05Z" is="relative-time">Jun 15, 2012</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>by design. there are docs involved to call hooks on.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-closed">
<div class="discussion-item-header" id="event-17839368">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-circle-slash"></span>
</span>
<img alt="@aheckmann" class="avatar" height="16" src="https://avatars1.githubusercontent.com/u/166834?v=3&amp;s=32" width="16" />
<a href="http://github.com/aheckmann" class="author">aheckmann</a>
      closed this   <a href="https://github.com/Automattic/mongoose/issues/964#event-17839368" class="timestamp"><time class="timestamp" datetime="2012-06-15T18:44:05Z" is="relative-time">Jun 15, 2012</time></a>
</div>
</div>
<div class="closed-banner"></div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/aheckmann"><img alt="@aheckmann" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/166834?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-6363682" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="515e85fa8c9c3893cbc6cb0cc4c5dfcb">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/aheckmann" class="author">aheckmann</a>
</strong>

    commented

    <a href="#issuecomment-6363682" class="timestamp">
<time datetime="2012-06-15T18:44:46Z" is="relative-time">Jun 15, 2012</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>correction, there are no docs to call hooks on.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/skotchio"><img alt="@skotchio" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/1432812?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-6363796" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="d38c53889aea7ad6ea92347f8e3d5649">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/skotchio" class="author">skotchio</a>
</strong>

    commented

    <a href="#issuecomment-6363796" class="timestamp">
<time datetime="2012-06-15T18:50:19Z" is="relative-time">Jun 15, 2012</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>So? If I want to call pre, post middleware I need to use the first approach?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/aheckmann"><img alt="@aheckmann" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/166834?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-6367106" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="10ec9f6c5c324db93f0f6c02306d1ed2">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/aheckmann" class="author">aheckmann</a>
</strong>

    commented

    <a href="#issuecomment-6367106" class="timestamp">
<time datetime="2012-06-15T21:30:57Z" is="relative-time">Jun 15, 2012</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>yes that is correct. Model.update,findByIdAndUpdate,findOneAndUpdate,findOneAndRemove,findByIdAndRemove are all commands executed directly in the database.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-pullrequest-7449989">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@oori" class="avatar" height="16" src="https://avatars3.githubusercontent.com/u/200688?v=3&amp;s=32" width="16" />
<a href="http://github.com/oori" class="author" truncate="true">oori</a>

      referenced
      this issue
        in <strong>jspears/mers</strong>
<a class="timestamp" href="#ref-pullrequest-7449989">
<time datetime="2012-10-09T14:56:42Z" is="relative-time">Oct 9, 2012</time>
</a>
</div>
<span class="state state-merged right">
<span aria-hidden="true" class="octicon octicon-git-pull-request"></span>
        Merged
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/jspears/mers/issues/3" class="title-link">
        Allow &quot;remove&quot; hooks
        <span class="issue-num">#3</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/jessefulton"><img alt="@jessefulton" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/40847?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-9967865" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="cd1de3e2071a50971f802ea7e8ad83f4">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/jessefulton" class="author">jessefulton</a>
</strong>

    commented

    <a href="#issuecomment-9967865" class="timestamp">
<time datetime="2012-11-01T01:03:35Z" is="relative-time">Nov 1, 2012</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>This should definitely be clarified in the <a href="http://mongoosejs.com/docs/documents.html">guide</a>, especially if you're talking about validation in that same page and describing <code>findByIdAndUpdate</code> as "better"</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/aheckmann"><img alt="@aheckmann" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/166834?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-9970615" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="6e607ea4061f5f5d50fd47434425fe1b">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<a href="#issuecomment-9970615" title="This comment left via email reply." class="comment-type-icon">
<span aria-hidden="true" class="octicon octicon-mail-read"></span>
</a>
<strong>
<a href="http://github.com/aheckmann" class="author">aheckmann</a>
</strong>

    commented

    <a href="#issuecomment-9970615" class="timestamp">
<time datetime="2012-11-01T04:22:10Z" is="relative-time">Nov 1, 2012</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body email-format js-comment-body">
<div class="email-fragment">if you click on the link "better" it takes you to the full documentation of
the method where it explains validation etc.

feel free to send a pull request to add something you feel is better. its
pretty easy to do so:
<a href="https://github.com/LearnBoost/mongoose/blob/master/CONTRIBUTING.md">https://github.com/LearnBoost/mongoose/blob/master/CONTRIBUTING.md</a>
</div>
<span class="email-hidden-toggle"><a href="#">…</a></span><div class="email-hidden-reply" style="display:none">
<div class="email-quoted-reply">On Wed, Oct 31, 2012 at 6:03 PM, Jesse Fulton &lt;notifications@github.com&gt;wrote:
 This should definitely be clarified in the guide&lt;<a href="http://mongoosejs.com/docs/documents.html">http://mongoosejs.com/docs/documents.html</a>&gt;,
 especially if you're talking about validation in that same page and
 describing findByIdAndUpdate as "better"

 —
 Reply to this email directly or view it on GitHub&lt;<a href="https://github.com/Automattic/mongoose/issues/964#issuecomment-9967865" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964 (comment)</a>&gt;.

</div>
<div class="email-fragment"></div>
<div class="email-signature-reply">-- 
Aaron
@aaronheckmann &lt;<a href="https://twitter.com/#!/aaronheckmann">https://twitter.com/#!/aaronheckmann</a>&gt;</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/sstadelman"><img alt="@sstadelman" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/377404?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-27130884" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="2b1fb803542e8c97b2856daaae04e141">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/sstadelman" class="author">sstadelman</a>
</strong>

    commented

    <a href="#issuecomment-27130884" class="timestamp">
<time datetime="2013-10-25T22:31:10Z" is="relative-time">Oct 25, 2013</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Added notes to the middleware doc </p>
<p>Pull request:  <a href="https://github.com/Automattic/mongoose/pull/1750" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/1750" data-id="21620198" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#1750</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
      This was referenced <time datetime="2013-10-31T16:25:14Z" is="relative-time">Oct 31, 2013</time>
</div>
<div class="discussion-item-rollup-ref">
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-closed"></span>
            Closed
          </span>
<div class="discussion-item-header" id="ref-issue-21867893">
<h3 class="discussion-item-ref-title">
<a href="http://github.com/HabitRPG/habitrpg/issues/1676" class="title-link">
              Participant count never increases

              <span class="issue-num">
                HabitRPG/habitrpg#1676
              </span>
</a> </h3>
</div>
</div>
<div class="discussion-item-rollup-ref">
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-closed"></span>
            Closed
          </span>
<div class="discussion-item-header" id="ref-issue-34536506">
<h3 class="discussion-item-ref-title">
<a href="http://github.com/linnovate/mean/issues/538" class="title-link">
              update array of objectId best practice.

              <span class="issue-num">
                linnovate/mean#538
              </span>
</a> </h3>
</div>
</div>
<div class="discussion-item-rollup-ref">
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-closed"></span>
            Closed
          </span>
<div class="discussion-item-header" id="ref-issue-32950905">
<h3 class="discussion-item-ref-title">
<a href="http://github.com/drudge/mongoose-timestamp/issues/13" class="title-link">
              updatedAt not updated when i do some updated to document

              <span class="issue-num">
                drudge/mongoose-timestamp#13
              </span>
</a> </h3>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/albanm"><img alt="@albanm" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/164958?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-45579135" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="e10ab3c70b150791203291761d4daf5d">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/albanm" class="author">albanm</a>
</strong>

    commented

    <a href="#issuecomment-45579135" class="timestamp">
<time datetime="2014-06-10T06:45:50Z" is="relative-time">Jun 10, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Hello,</p>
<p>I know the issue is closed, but I am not entirely satisfied with the answer. Shouldn't there be at least a post-save or post-update middleware for findOneAndUpdate and other similar operations ? Is seems ok since the document is returned. Not feasible for pre middlewares or for Model.update, i agree.</p>
<p>It would greatly improve the capabilities of plugins such as mongoosastic that is currently blind to some operations it should be able to support.</p>
<p>If no middleware, does someone have an idea on how to manage some post update operations in a plugin ?</p>
<p>Thanks</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-milestoned">
<div class="discussion-item-header" id="event-129887387">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-milestone"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      added this to the <a href="http://github.com/Automattic/mongoose/milestones/4.0" class="discussion-item-entity">4.0</a> milestone <a href="https://github.com/Automattic/mongoose/issues/964#event-129887387" class="timestamp"><time class="timestamp" datetime="2014-06-10T17:09:43Z" is="relative-time">Jun 10, 2014</time></a>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/jessefulton"><img alt="@jessefulton" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/40847?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-46713011" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="3cb40f7864fae32a7796cfe2762f1e95">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/jessefulton" class="author">jessefulton</a>
</strong>

    commented

    <a href="#issuecomment-46713011" class="timestamp">
<time datetime="2014-06-20T18:46:17Z" is="relative-time">Jun 20, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/albanm" class="user-mention">@albanm</a> certain methods <a href="http://mongoosejs.com/docs/middleware.html#notes">bypass mongoose completely</a>, so you don't get the middleware hooks. AFAIK, the only way to get the hooks to execute is to use separate <code>find()</code> and <code>save()</code> calls as mentioned above.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/albanm"><img alt="@albanm" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/164958?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-46718882" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="26ab987b517028ea7dd719d7e92899ef">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/albanm" class="author">albanm</a>
</strong>

    commented

    <a href="#issuecomment-46718882" class="timestamp">
<time datetime="2014-06-20T19:45:06Z" is="relative-time">Jun 20, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>I get that and it makes sense. Pre middlewares are out of question as there is no fetching prior to certain methods. But still, mongoose should be able to wrap the update operations that also return the updated documents and trigger some post hooks.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/beetaa"><img alt="@beetaa" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/5688224?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-47724771" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="052a27bde5205382d54018f5ca4469fb">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/beetaa" class="author">beetaa</a>
</strong>

    commented

    <a href="#issuecomment-47724771" class="timestamp">
<time datetime="2014-07-02T00:25:33Z" is="relative-time">Jul 2, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>I think <a href="https://github.com/albanm" class="user-mention">@albanm</a> is right, People may want the same functionality when they use the same function. How about wrap those 'directly update' methods with some interception of check that if there's any hooks exist? If hook exist, use it, or call original update methods otherwise.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/joafeldmann"><img alt="@joafeldmann" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/1437079?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-49014877" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7015440590904d38e35615ff0672d21c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/joafeldmann" class="author">joafeldmann</a>
</strong>

    commented

    <a href="#issuecomment-49014877" class="timestamp">
<time datetime="2014-07-15T10:34:28Z" is="relative-time">Jul 15, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/sunfuze"><img alt="@sunfuze" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/1171762?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-50103571" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7015440590904d38e35615ff0672d21c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/sunfuze" class="author">sunfuze</a>
</strong>

    commented

    <a href="#issuecomment-50103571" class="timestamp">
<time datetime="2014-07-25T03:03:24Z" is="relative-time">Jul 25, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/perok"><img alt="@perok" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1502013?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-50474510" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7015440590904d38e35615ff0672d21c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/perok" class="author">perok</a>
</strong>

    commented

    <a href="#issuecomment-50474510" class="timestamp">
<time datetime="2014-07-29T13:18:51Z" is="relative-time">Jul 29, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-38388928">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@perok" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1502013?v=3&amp;s=32" width="16" />
<a href="http://github.com/perok" class="author" truncate="true">perok</a>

      referenced
      this issue
        in <strong>nicholasconfer/mongoose-times</strong>
<a class="timestamp" href="#ref-issue-38388928">
<time datetime="2014-07-29T13:27:30Z" is="relative-time">Jul 29, 2014</time>
</a>
</div>
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Closed
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/nicholasconfer/mongoose-times/issues/4" class="title-link">
        Does not work with findOneAndUpdate and upsert
        <span class="issue-num">#4</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/ludwiksh"><img alt="@ludwiksh" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/3131349?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-52003419" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7015440590904d38e35615ff0672d21c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/ludwiksh" class="author">ludwiksh</a>
</strong>

    commented

    <a href="#issuecomment-52003419" class="timestamp">
<time datetime="2014-08-13T02:38:46Z" is="relative-time">Aug 13, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-643aa3a">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@creynders" class="avatar" height="16" src="https://avatars1.githubusercontent.com/u/436347?v=3&amp;s=32" width="16" />
<a href="http://github.com/creynders" class="author" truncate="true">creynders</a>

        added a commit
          to d-pac/d-pac.cms
        that referenced
        this issue

      <a href="#ref-commit-643aa3a" class="timestamp">
<time datetime="2014-08-13T14:20:23Z" is="relative-time">Aug 13, 2014</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:643aa3a40477db119ee32b25a74046ae481cbd85" data-url="/Automattic/mongoose/commit/643aa3a40477db119ee32b25a74046ae481cbd85/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/creynders"><img alt="@creynders" class="avatar avatar-small" height="16" src="https://avatars1.githubusercontent.com/u/436347?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/creynders" class="author" rel="contributor">creynders</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/d-pac/d-pac.cms/commit/643aa3a40477db119ee32b25a74046ae481cbd85" class="message" data-pjax="true" title="Rewrite api.user.update to allow for saving of passwords

See https://github.com/LearnBoost/mongoose/issues/964">Rewrite api.user.update to allow for saving of passwords</a></code>
<span class="hidden-text-expander inline">
<a href="#" class="js-details-target">&hellip;</a>
</span>
<div class="commit-desc"><pre class="text-small">See <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">Automattic/mongoose#964</a></pre></div>
</td>
<td class="commit-meta">
<code><a href="http://github.com/d-pac/d-pac.cms/commit/643aa3a40477db119ee32b25a74046ae481cbd85" class="commit-id">643aa3a</a></code>
</td>
</tr>
</table>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/cebor"><img alt="@cebor" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/1576120?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-52765408" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="1b7cbfa154fac9cdfcd76aaad31ec3d3">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/cebor" class="author">cebor</a>
</strong>

    commented

    <a href="#issuecomment-52765408" class="timestamp">
<time datetime="2014-08-20T11:56:26Z" is="relative-time">Aug 20, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><img class="emoji" title=":+1:" alt=":+1:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f44d.png" height="20" width="20" align="absmiddle" /> </p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-40677983">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@Zertz" class="avatar" height="16" src="https://avatars0.githubusercontent.com/u/2636763?v=3&amp;s=32" width="16" />
<a href="http://github.com/Zertz" class="author" truncate="true">Zertz</a>

      referenced
      this issue
        in <strong>florianholzapfel/express-restify-mongoose</strong>
<a class="timestamp" href="#ref-issue-40677983">
<time datetime="2014-08-21T02:00:02Z" is="relative-time">Aug 21, 2014</time>
</a>
</div>
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Closed
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/florianholzapfel/express-restify-mongoose/issues/62" class="title-link">
        Add ability to use mongoose middleware
        <span class="issue-num">#62</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/syzer"><img alt="@syzer" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/1989646?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-52885679" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7015440590904d38e35615ff0672d21c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/syzer" class="author">syzer</a>
</strong>

    commented

    <a href="#issuecomment-52885679" class="timestamp">
<time datetime="2014-08-21T07:08:33Z" is="relative-time">Aug 21, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/askhogan"><img alt="@askhogan" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/635449?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-53930358" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="dccd4eb3257a6f83efed56c697cf3e91">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/askhogan" class="author">askhogan</a>
</strong>

    commented

    <a href="#issuecomment-53930358" class="timestamp">
<time datetime="2014-08-29T21:11:00Z" is="relative-time">Aug 29, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><img class="emoji" title=":-1:" alt=":-1:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f44e.png" height="20" width="20" align="absmiddle" /><br /><br />
I get the feature request, but the longer I work with middleware, I find myself needing to bypass middleware often when calling db update scripts and other items that are not routine to my normal operations.  By using static methods it becomes very easy to create a custom wrapper that implements the above feature requests already.  Since mongoose is now opening to ideas for version 4, it is unlikely that any API change of this magnitude will happen in v3.  I request that this be moved to v4 discussion.</p>
<p>I would however, <img class="emoji" title=":+1:" alt=":+1:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f44d.png" height="20" width="20" align="absmiddle" />  if I was able to disable middleware on a save call.  I often find myself with a mongoose object that was passed from another function and simply want to perform a .save - in this situation, doing a .save is preferable to writing a new query.   If this is possible, please point it out </p>
<p>Either way, amazing library.  Kudos to awesome maintainers.  Not sure how I would operate without it. </p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/roymap"><img alt="@roymap" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/201791?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-56035334" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7015440590904d38e35615ff0672d21c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/roymap" class="author">roymap</a>
</strong>

    commented

    <a href="#issuecomment-56035334" class="timestamp">
<time datetime="2014-09-18T13:09:19Z" is="relative-time">Sep 18, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/sailxjx"><img alt="@sailxjx" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/909853?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-57048964" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="38a350fae7b79e4b8fc330d77fbb5840">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/sailxjx" class="author">sailxjx</a>
</strong>

    commented

    <a href="#issuecomment-57048964" class="timestamp">
<time datetime="2014-09-27T10:42:15Z" is="relative-time">Sep 27, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>A simple way to add hooks for these method is overwrite the embed functions:</p>
<div class="highlight highlight-source-coffee"><pre><span class="pl-v"><span class="pl-v">_update <span class="pl-k">=</span></span></span> UserModel.update
<span class="pl-en">UserModel.update </span><span class="pl-k">=</span><span class="pl-smi"> <span class="pl-smi">(conditions, update)</span></span> <span class="pl-k"><span class="pl-k">-&gt;</span></span>
  <span class="pl-v"><span class="pl-v">update.updatedAt <span class="pl-k">or=</span></span></span> <span class="pl-k">new</span> <span class="pl-en">Date</span>
  _update.<span class="pl-en">apply </span><span class="pl-v">this</span>, arguments</pre></div>
<p>Then every update call of mongoose will fix the updatedAt key of data.</p>
<p>You may give a try of this model <a href="https://github.com/teambition/limbo">limbo</a>. It is a simple wrapper of mongoose model, supporting bind static/method/overwrite to all the schemas, and call rpc methods to query the mongodb.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-46586732">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@SnidelyWhiplash" class="avatar" height="16" src="https://avatars0.githubusercontent.com/u/6245069?v=3&amp;s=32" width="16" />
<a href="http://github.com/SnidelyWhiplash" class="author" truncate="true">SnidelyWhiplash</a>

      referenced
      this issue
        in <strong>achingbrain/mongoose-crate</strong>
<a class="timestamp" href="#ref-issue-46586732">
<time datetime="2014-10-28T18:05:20Z" is="relative-time">Oct 28, 2014</time>
</a>
</div>
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Closed
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/achingbrain/mongoose-crate/issues/4" class="title-link">
        Delete is not removing files from s3 bucket.
        <span class="issue-num">#4</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/asinha08"><img alt="@asinha08" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/604180?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-68205937" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="27f35003d731d3a46368e1af52c4eabc">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/asinha08" class="author">asinha08</a>
</strong>

    commented

    <a href="#issuecomment-68205937" class="timestamp">
<time datetime="2014-12-28T12:32:26Z" is="relative-time">Dec 28, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1, need this feature...</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/joerx"><img alt="@joerx" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1712460?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-68327649" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="2ee4f7f8c3d8b250a29327aa5f77e50f">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/joerx" class="author">joerx</a>
</strong>

    commented

    <a href="#issuecomment-68327649" class="timestamp">
<time datetime="2014-12-30T03:42:35Z" is="relative-time">Dec 30, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>While I sort of understand the reasoning, the lack of hooks on atomic updates IMHO makes Mongoose somewhat pointless in practice. When I use atomic updates any validations, defaults, etc. are not executed, so the entire purpose of using an ODM is defeated. Using find/save will do the job, but is there any guarantee this is always used?  </p>
<p>Moreover, usually I would try to avoid find/save since it's not an atomic operation. MongoDB compensates it's lack of transaction support by providing powerful atomic query &amp; update features. So I would use these atomic operations but w/o middleware support Mongoose won't provide much value over the native <code>MongoClient</code>.</p>
<p>Even the examples in <a href="http://aaronheckmann.tumblr.com/post/48943525537/mongoose-v3-part-1-versioning">http://aaronheckmann.tumblr.com/post/48943525537/mongoose-v3-part-1-versioning</a> would use <code>update</code>, hence bypass middleware. I can use versioning properly or middleware but not combine both? Really, where's the point in having it?</p>
<p>I don't even fully understand the technical reasons: If <code>update</code> &amp; co. wrap around the database operations, why can't we intercept the call and pass the query objects so we can do some validation/customization before we actually do the update?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/syzer"><img alt="@syzer" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/1989646?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-68339513" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="b68ead31f6a5859770361b807589f06b">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/syzer" class="author">syzer</a>
</strong>

    commented

    <a href="#issuecomment-68339513" class="timestamp">
<time datetime="2014-12-30T08:47:47Z" is="relative-time">Dec 30, 2014</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/joerx" class="user-mention">@joerx</a> +1 would suffice.. :) but your reasoning is flawless.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-milestoned">
<div class="discussion-item-header" id="event-213468177">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-milestone"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
       modified the milestone: <a href="http://github.com/Automattic/mongoose/milestones/4.0.0-rc0" class="discussion-item-entity" title="by vkarpov15 at 2015-01-02 15:57:59">4.0.0-rc0</a>, <a href="http://github.com/Automattic/mongoose/milestones/4.0" class="discussion-item-entity" title="by vkarpov15 at 2015-01-02 15:57:59">4.0</a> <a href="https://github.com/Automattic/mongoose/issues/964#event-213468177" class="timestamp"><time class="timestamp" datetime="2015-01-02T15:57:59Z" is="relative-time">Jan 2, 2015</time></a>
</div>
</div>
<div class="discussion-item discussion-item-reopened">
<div class="discussion-item-header" id="event-213468404">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-primitive-dot"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      reopened this   <a href="https://github.com/Automattic/mongoose/issues/964#event-213468404" class="timestamp"><time class="timestamp" datetime="2015-01-02T15:58:51Z" is="relative-time">Jan 2, 2015</time></a>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-68536986" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="cb9cbfb3dd70f9a942d81c43a635930d">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-68536986" class="timestamp">
<time datetime="2015-01-02T15:59:36Z" is="relative-time">Jan 2, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>The 3.9.x branch has support for pre and post hooks for <code>find</code> and <code>findOne</code> - should be easy to add support for <code>findOneAndUpdate</code> and <code>update</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-cf496b1">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

        added a commit
        that referenced
        this issue

      <a href="#ref-commit-cf496b1" class="timestamp">
<time datetime="2015-01-04T23:26:22Z" is="relative-time">Jan 4, 2015</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:cf496b17e912476b04b966be458b5dad7a6b68a6" data-url="/Automattic/mongoose/commit/cf496b17e912476b04b966be458b5dad7a6b68a6/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="avatar avatar-small" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/vkarpov15" class="author" rel="contributor">vkarpov15</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/Automattic/mongoose/commit/cf496b17e912476b04b966be458b5dad7a6b68a6" class="message" data-pjax="true" title="Test coverage for #964">Test coverage for</a> <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964</a></code>
</td>
<td class="commit-meta">
<code><a href="http://github.com/Automattic/mongoose/commit/cf496b17e912476b04b966be458b5dad7a6b68a6" class="commit-id">cf496b1</a></code>
</td>
</tr>
</table>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-e98ef98">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

        added a commit
        that referenced
        this issue

      <a href="#ref-commit-e98ef98" class="timestamp">
<time datetime="2015-01-04T23:26:22Z" is="relative-time">Jan 4, 2015</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:e98ef98e857965c4b2ae3339fdd7eefd2a5a9913" data-url="/Automattic/mongoose/commit/e98ef98e857965c4b2ae3339fdd7eefd2a5a9913/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="avatar avatar-small" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/vkarpov15" class="author" rel="contributor">vkarpov15</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/Automattic/mongoose/commit/e98ef98e857965c4b2ae3339fdd7eefd2a5a9913" class="message" data-pjax="true" title="Add implementation #964">Add implementation</a> <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964</a></code>
</td>
<td class="commit-meta">
<code><a href="http://github.com/Automattic/mongoose/commit/e98ef98e857965c4b2ae3339fdd7eefd2a5a9913" class="commit-id">e98ef98</a></code>
</td>
</tr>
</table>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
      This was referenced <time datetime="2015-01-04T23:33:38Z" is="relative-time">Jan 4, 2015</time>
</div>
<div class="discussion-item-rollup-ref">
<span class="state state-merged right">
<span aria-hidden="true" class="octicon octicon-git-pull-request"></span>
            Merged
          </span>
<div class="discussion-item-header" id="ref-pullrequest-53353056">
<h3 class="discussion-item-ref-title">
<a href="http://github.com/Automattic/mongoose/issues/2575" class="title-link">
              Pre and post hooks for findOneAndUpdate

              <span class="issue-num">
                #2575
              </span>
</a> </h3>
</div>
</div>
<div class="discussion-item-rollup-ref">
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-closed"></span>
            Closed
          </span>
<div class="discussion-item-header" id="ref-issue-53344341">
<h3 class="discussion-item-ref-title">
<a href="http://github.com/keystonejs/keystone/issues/854" class="title-link">
              AutoKey not working for upserts.

              <span class="issue-num">
                keystonejs/keystone#854
              </span>
</a> </h3>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/theGlenn"><img alt="@theGlenn" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/3216616?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-68852757" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="fcdfcbcc5f10c8087cd9c44250a9b058">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/theGlenn" class="author">theGlenn</a>
</strong>

    commented

    <a href="#issuecomment-68852757" class="timestamp">
<time datetime="2015-01-06T11:04:19Z" is="relative-time">Jan 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Is this feature merged ?</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-3c9f5b3">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

        added a commit
        that referenced
        this issue

      <a href="#ref-commit-3c9f5b3" class="timestamp">
<time datetime="2015-01-06T15:38:31Z" is="relative-time">Jan 6, 2015</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:3c9f5b32b6ee353d194fae6e293eba36ded13003" data-url="/Automattic/mongoose/commit/3c9f5b32b6ee353d194fae6e293eba36ded13003/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="avatar avatar-small" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/vkarpov15" class="author" rel="contributor">vkarpov15</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/Automattic/mongoose/commit/3c9f5b32b6ee353d194fae6e293eba36ded13003" class="message" data-pjax="true" title="Merge branch 'master' into gh-964">Merge branch 'master' into</a> <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">gh-964</a></code>
</td>
<td class="commit-meta">
<code><a href="http://github.com/Automattic/mongoose/commit/3c9f5b32b6ee353d194fae6e293eba36ded13003" class="commit-id">3c9f5b3</a></code>
</td>
</tr>
</table>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-68894569" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="5db80c0cb0b137cfed71f245bec5bd6d">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-68894569" class="timestamp">
<time datetime="2015-01-06T17:02:51Z" is="relative-time">Jan 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>So the <code>pre('findOneAndUpdate')</code> and <code>post('findOneAndUpdate')</code> hooks are in master, there isn't an update hook just yet. There's no release that contains either of those yet.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-9d3b4ce">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

        added a commit
        that referenced
        this issue

      <a href="#ref-commit-9d3b4ce" class="timestamp">
<time datetime="2015-01-21T16:03:04Z" is="relative-time">Jan 21, 2015</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:9d3b4ce53b9292fda46aca22ce6bc404618d1484" data-url="/Automattic/mongoose/commit/9d3b4ce53b9292fda46aca22ce6bc404618d1484/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="avatar avatar-small" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/vkarpov15" class="author" rel="contributor">vkarpov15</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/Automattic/mongoose/commit/9d3b4ce53b9292fda46aca22ce6bc404618d1484" class="message" data-pjax="true" title="Some cleanup for update hooks #964">Some cleanup for update hooks</a> <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964</a></code>
</td>
<td class="commit-meta">
<code><a href="http://github.com/Automattic/mongoose/commit/9d3b4ce53b9292fda46aca22ce6bc404618d1484" class="commit-id">9d3b4ce</a></code>
</td>
</tr>
</table>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-8804460">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

        added a commit
        that referenced
        this issue

      <a href="#ref-commit-8804460" class="timestamp">
<time datetime="2015-01-21T16:03:04Z" is="relative-time">Jan 21, 2015</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:8804460e6ca55648aebf1e83612355b28cbaba76" data-url="/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="avatar avatar-small" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/vkarpov15" class="author" rel="contributor">vkarpov15</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76" class="message" data-pjax="true" title="Fix #964: add update middleware">Fix</a> <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964</a><a href="http://github.com/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76" class="message" data-pjax="true" title="Fix #964: add update middleware">: add update middleware</a></code>
</td>
<td class="commit-meta">
<code><a href="http://github.com/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76" class="commit-id">8804460</a></code>
</td>
</tr>
</table>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-pullrequest-55038073">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

      referenced
      this issue
      <a class="timestamp" href="#ref-pullrequest-55038073">
<time datetime="2015-01-21T16:03:33Z" is="relative-time">Jan 21, 2015</time>
</a>
</div>
<span class="state state-merged right">
<span aria-hidden="true" class="octicon octicon-git-pull-request"></span>
        Merged
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/Automattic/mongoose/issues/2608" class="title-link">
        Update middleware
        <span class="issue-num">#2608</span>
</a> </h3>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-8804460">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

        added a commit
        that closed
        this issue

      <a href="#ref-commit-8804460" class="timestamp">
<time datetime="2015-01-21T16:04:55Z" is="relative-time">Jan 21, 2015</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:8804460e6ca55648aebf1e83612355b28cbaba76" data-url="/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="avatar avatar-small" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/vkarpov15" class="author" rel="contributor">vkarpov15</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76" class="message" data-pjax="true" title="Fix #964: add update middleware">Fix</a> <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964</a><a href="http://github.com/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76" class="message" data-pjax="true" title="Fix #964: add update middleware">: add update middleware</a></code>
</td>
<td class="commit-meta">
<code><a href="http://github.com/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76" class="commit-id">8804460</a></code>
</td>
</tr>
</table>
</div>
<div class="discussion-item discussion-item-closed">
<div class="discussion-item-header" id="event-222407292">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-circle-slash"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      closed this in <code><a href="http://github.com/Automattic/mongoose/commit/8804460e6ca55648aebf1e83612355b28cbaba76">8804460</a></code> <a href="https://github.com/Automattic/mongoose/issues/964#event-222407292" class="timestamp"><time class="timestamp" datetime="2015-01-21T16:04:55Z" is="relative-time">Jan 21, 2015</time></a>
</div>
</div>
<div class="closed-banner"></div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/krzysztofantczak"><img alt="@krzysztofantczak" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/2803248?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-74634730" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="667a276a8aee50299ff31406e551b273">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/krzysztofantczak" class="author">krzysztofantczak</a>
</strong>

    commented

    <a href="#issuecomment-74634730" class="timestamp">
<time datetime="2015-02-17T08:47:52Z" is="relative-time">Feb 17, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>So does it triggers pre-save after .update() now?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-74705796" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="7b01d79271e797a4de412d62e7325e45">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-74705796" class="timestamp">
<time datetime="2015-02-17T17:08:11Z" is="relative-time">Feb 17, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>No. There is a separate <code>update()</code> hook for <code>Query.update()</code>. Save hooks are distinct from query hooks.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/karlstanton"><img alt="@karlstanton" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/302968?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-74805236" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="be74a3b4c4540b442320dee668c284c5">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/karlstanton" class="author">karlstanton</a>
</strong>

    commented

    <a href="#issuecomment-74805236" class="timestamp">
<time datetime="2015-02-18T03:27:42Z" is="relative-time">Feb 18, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> Can you please link to the supporting documentation for the update hook? Any word on when <code>pre('findOneAndUpdate')</code> and <code>post('findOneAndUpdate')</code> will hit a release?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-74916577" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="fa13dc38cbd1e82b427eacc8d6c630ee">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-74916577" class="timestamp">
<time datetime="2015-02-18T18:16:21Z" is="relative-time">Feb 18, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/karlstanton" class="user-mention">@karlstanton</a> use 4.0.0-rc2, <code>npm install mongoose@unstable</code> :)</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/neverfox"><img alt="@neverfox" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/3344033?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-76326724" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="945f4652f4ac7a881fd402985b671aa5">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/neverfox" class="author">neverfox</a>
</strong>

    commented

    <a href="#issuecomment-76326724" class="timestamp">
<time datetime="2015-02-27T03:54:57Z" is="relative-time">Feb 27, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<div class="highlight highlight-source-js"><pre><span class="pl-s"><span class="pl-pds">'</span>use strict<span class="pl-pds">'</span></span>;

<span class="pl-k">var</span> Promise  <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>bluebird<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> mongoose <span class="pl-k">=</span> <span class="pl-smi">Promise</span>.<span class="pl-en">promisifyAll</span>(<span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>mongoose<span class="pl-pds">'</span></span>));

<span class="pl-k">var</span> counterSchema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    total<span class="pl-k">:</span> {
        type<span class="pl-k">:</span>    <span class="pl-c1">Number</span>,
        <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-c1">0</span>
    }
});

<span class="pl-smi">counterSchema</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">doc</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">doc</span>.<span class="pl-smi">total</span>);
});

<span class="pl-k">var</span> Counter <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-en">model</span>(<span class="pl-s"><span class="pl-pds">'</span>Counter<span class="pl-pds">'</span></span>, counterSchema);

<span class="pl-smi">Promise</span>.<span class="pl-en">coroutine</span>(<span class="pl-k">function</span> <span class="pl-k">*</span>() {
    <span class="pl-k">yield</span> <span class="pl-smi">mongoose</span>.<span class="pl-en">connectAsync</span>(<span class="pl-smi">process</span>.<span class="pl-smi">env</span>.<span class="pl-c1">MONGODB_URI</span>);
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Connected<span class="pl-pds">'</span></span>);
    <span class="pl-k">let</span> counter <span class="pl-k">=</span> <span class="pl-k">yield</span> <span class="pl-smi">Counter</span>.<span class="pl-en">createAsync</span>({});
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">`</span><span class="pl-s1"><span class="pl-pse">${</span><span class="pl-smi">counter</span>.<span class="pl-smi">total</span><span class="pl-pse">}</span></span><span class="pl-pds">`</span></span>);
    <span class="pl-k">for</span> (<span class="pl-k">let</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-c1">10</span>; i<span class="pl-k">++</span>) {
        <span class="pl-k">yield</span> <span class="pl-smi">Counter</span>.<span class="pl-en">findOneAndUpdateAsync</span>({ _id<span class="pl-k">:</span> <span class="pl-smi">counter</span>.<span class="pl-c1">id</span> }, { $inc<span class="pl-k">:</span> { total<span class="pl-k">:</span> <span class="pl-c1">1</span>} });
    }
})();</pre></div>
<pre><code>Connected
0
0
1
2
3
4
5
6
7
8
9
</code></pre>
<p>Seems like it's a step behind. What am I missing?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/neverfox"><img alt="@neverfox" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/3344033?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-76326991" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="65c0d381ad7ae5f207f2260d2916fa5a">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/neverfox" class="author">neverfox</a>
</strong>

    commented

    <a href="#issuecomment-76326991" class="timestamp">
<time datetime="2015-02-27T03:59:27Z" is="relative-time">Feb 27, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>AH, the <code>new</code> flag default breaking change. While there's something to say about consistency with the underlying driver, I have to say it's really counter-intuitive, especially when considering this new hook.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/syzer"><img alt="@syzer" class="timeline-comment-avatar" height="48" src="https://avatars2.githubusercontent.com/u/1989646?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-76346917" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="19fa443269914eae5cdd84eace6d865b">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/syzer" class="author">syzer</a>
</strong>

    commented

    <a href="#issuecomment-76346917" class="timestamp">
<time datetime="2015-02-27T06:41:56Z" is="relative-time">Feb 27, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/neverfox" class="user-mention">@neverfox</a> :)</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-76464160" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="991654afdaa6b99d80a862d785db07df">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-76464160" class="timestamp">
<time datetime="2015-02-27T20:16:33Z" is="relative-time">Feb 27, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Yeah <a href="https://github.com/neverfox" class="user-mention">@neverfox</a> good catch. This change is <a href="https://github.com/LearnBoost/mongoose/wiki/4.0-Release-Notes#backwards-breaking-changes">documented in the release notes</a> and you can see more discussion why this was changed in <a href="https://github.com/Automattic/mongoose/issues/2262" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/2262" data-id="40764594" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#2262</a>.</p>
<p>The reason is that <code>new</code> is false by default in the mongodb node driver, the mongodb shell, the actual mongodb server, etc. and wrapper layers setting non-standard defaults makes life difficult for devs. My canonical example of a module that gets this horribly wrong is <a href="https://www.npmjs.com/package/gulp-uglify">gulp-uglify</a>, which overrides a bunch of uglify-js's defaults.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-59832098">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@Jeff-Lewis" class="avatar" height="16" src="https://avatars0.githubusercontent.com/u/676289?v=3&amp;s=32" width="16" />
<a href="http://github.com/Jeff-Lewis" class="author" truncate="true">Jeff-Lewis</a>

      referenced
      this issue
        in <strong>strongloop/loopback-datasource-juggler</strong>
<a class="timestamp" href="#ref-issue-59832098">
<time datetime="2015-03-05T00:16:00Z" is="relative-time">Mar 5, 2015</time>
</a>
</div>
<span class="state state-open right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Open
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/strongloop/loopback-datasource-juggler/issues/482" class="title-link">
        Pain-points of the new Operation hooks
        <span class="issue-num">#482</span>
</a> </h3>
<span class="issue-meta-section task-progress"><span aria-hidden="true" class="octicon octicon-checklist"></span><span class="task-progress-counts">6 of 8 tasks complete</span><span class="progress-bar"><span class="progress" style="width: 75%"></span></span></span>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/CaptainStaplerz"><img alt="@CaptainStaplerz" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/11563478?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-98592270" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="2db18f8bf43e67fca9b471f5e2233b11">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/CaptainStaplerz" class="author">CaptainStaplerz</a>
</strong>

    commented

    <a href="#issuecomment-98592270" class="timestamp">
<time datetime="2015-05-04T05:38:47Z" is="relative-time">May 4, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>I see that the issue is closed, but is the functionality in place in version 4.0.2 out is it just still in the unstable version? It doesn't seem to execute on findOneAndUpdate with Scema.pre('update') or Schema.pre('findOneAndUpdate') with the 4.0.2 version. Am I missing something that I have to pass to the function?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-98701739" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="cd40dde03374a017b1d5ed5a830994f9">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-98701739" class="timestamp">
<time datetime="2015-05-04T13:14:30Z" is="relative-time">May 4, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>How are you declaring the pre hook <a href="https://github.com/CaptainStaplerz" class="user-mention">@CaptainStaplerz</a> ?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/honitus"><img alt="@honitus" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/11481768?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-98805695" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="b43070feea7e67401232cc0d35ccbfaa">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/honitus" class="author">honitus</a>
</strong>

    commented

    <a href="#issuecomment-98805695" class="timestamp">
<time datetime="2015-05-04T18:30:29Z" is="relative-time">May 4, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Is findOneAndUpdate middleware hook available in 4.0.2? I upgraded from 3.8 to latest mongoose 4.0.2 to use this and the middlware Document.schema.post('findOneAndUpdate', function (doc) is not getting triggered like save() or remove() does</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-98811001" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="f084809efd6b1af85ec017f9119bc8ba">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-98811001" class="timestamp">
<time datetime="2015-05-04T18:49:18Z" is="relative-time">May 4, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/honitus" class="user-mention">@honitus</a> show me your code</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/honitus"><img alt="@honitus" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/11481768?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-98820715" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="5704d678e768c35f7fe064f469749f83">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/honitus" class="author">honitus</a>
</strong>

    commented

    <a href="#issuecomment-98820715" class="timestamp">
<time datetime="2015-05-04T19:13:14Z" is="relative-time">May 4, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a>  - Thanks for quick response, here you go</p>
<p><strong>blog.controller,js</strong></p>
<div class="highlight highlight-source-js"><pre><span class="pl-c">// Updates an existing Blog in the DB, adds comment</span>
<span class="pl-c1">exports</span>.<span class="pl-en">update</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {

<span class="pl-smi">Blog</span>.<span class="pl-en">findOneAndUpdate</span>(
     {<span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-smi">req</span>.<span class="pl-c1">body</span>.<span class="pl-smi">_id</span>,},
      {<span class="pl-s"><span class="pl-pds">"</span>$push<span class="pl-pds">"</span></span><span class="pl-k">:</span> {<span class="pl-s"><span class="pl-pds">"</span>comments<span class="pl-pds">"</span></span><span class="pl-k">:</span> buildComment}},
     {safe<span class="pl-k">:</span> <span class="pl-c1">true</span>, upsert<span class="pl-k">:</span> <span class="pl-c1">true</span>}, <span class="pl-k">function</span> (<span class="pl-smi">err</span>, <span class="pl-smi">workspace</span>) {
      <span class="pl-k">if</span> (err) {
         <span class="pl-k">return</span> <span class="pl-en">handleError</span>(res, err);
       }
       <span class="pl-k">return</span> <span class="pl-smi">res</span>.<span class="pl-c1">send</span>(<span class="pl-c1">200</span>);
      }
   );

}</pre></div>
<p><strong>blog.socket.js</strong></p>
<div class="highlight highlight-source-js"><pre><span class="pl-c">/**</span>
<span class="pl-c"> * Broadcast updates to client when the model changes</span>
<span class="pl-c"> */</span>

<span class="pl-s"><span class="pl-pds">'</span>use strict<span class="pl-pds">'</span></span>;

<span class="pl-k">var</span> Blog<span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./blog.model<span class="pl-pds">'</span></span>);

<span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">socket</span>) {
<span class="pl-c">//SAVE WORKS</span>
  <span class="pl-smi">Blog</span>.<span class="pl-smi">schema</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">'</span>save<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">doc</span>) {
    <span class="pl-en">onSave</span>(socket, doc);
  });

<span class="pl-c">// IS NOT TRIGGERED :(</span>
 <span class="pl-smi">Blog</span>.<span class="pl-smi">schema</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">doc</span>) {
    <span class="pl-en">onComment</span>(socket, doc);
  });

  <span class="pl-smi">Blog</span>.<span class="pl-smi">schema</span>.<span class="pl-en">post</span>(<span class="pl-s"><span class="pl-pds">'</span>remove<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">doc</span>) {
    <span class="pl-en">onRemove</span>(socket, doc);
  });
}

<span class="pl-c">//SAVE WORKS when a new blog is created</span>
<span class="pl-k">function</span> <span class="pl-en">onSave</span>(<span class="pl-smi">socket</span>, <span class="pl-smi">doc</span>, <span class="pl-smi">cb</span>) {
  <span class="pl-smi">socket</span>.<span class="pl-en">emit</span>(<span class="pl-s"><span class="pl-pds">'</span>blog:save<span class="pl-pds">'</span></span>, doc);
}

<span class="pl-c">// IS NOT TRIGGERED :(</span>
<span class="pl-k">function</span> <span class="pl-en">onComment</span>(<span class="pl-smi">socket</span>, <span class="pl-smi">doc</span>, <span class="pl-smi">cb</span>) {
  <span class="pl-smi">socket</span>.<span class="pl-en">emit</span>(<span class="pl-s"><span class="pl-pds">'</span>blog:findOneAndUpdate<span class="pl-pds">'</span></span>, doc);
}

<span class="pl-k">function</span> <span class="pl-en">onRemove</span>(<span class="pl-smi">socket</span>, <span class="pl-smi">doc</span>, <span class="pl-smi">cb</span>) {
  <span class="pl-smi">socket</span>.<span class="pl-en">emit</span>(<span class="pl-s"><span class="pl-pds">'</span>blog:remove<span class="pl-pds">'</span></span>, doc);
}</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-reopened">
<div class="discussion-item-header" id="event-296592141">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-primitive-dot"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      reopened this   <a href="https://github.com/Automattic/mongoose/issues/964#event-296592141" class="timestamp"><time class="timestamp" datetime="2015-05-04T19:56:32Z" is="relative-time">May 4, 2015</time></a>
</div>
</div>
<div class="discussion-item discussion-item-milestoned">
<div class="discussion-item-header" id="event-296592200">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-milestone"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
       modified the milestone: <a href="http://github.com/Automattic/mongoose/milestones/4.0.3" class="discussion-item-entity" title="by vkarpov15 at 2015-05-04 19:56:36">4.0.3</a>, <a href="http://github.com/Automattic/mongoose/milestones/4.0.0-rc0" class="discussion-item-entity" title="by vkarpov15 at 2015-05-04 19:56:36">4.0.0-rc0</a> <a href="https://github.com/Automattic/mongoose/issues/964#event-296592200" class="timestamp"><time class="timestamp" datetime="2015-05-04T19:56:36Z" is="relative-time">May 4, 2015</time></a>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/honitus"><img alt="@honitus" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/11481768?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-98844092" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="f7b7e420db3ac8f27b1dbf7873591dac">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/honitus" class="author">honitus</a>
</strong>

    commented

    <a href="#issuecomment-98844092" class="timestamp">
<time datetime="2015-05-04T20:38:31Z" is="relative-time">May 4, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a>  Thanks for reopening. Does this mean hook for findOneAndUpdate isn't there in 4.0.2 and you plan to include in 4.0.3.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/CaptainStaplerz"><img alt="@CaptainStaplerz" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/11563478?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-98845169" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="567b5515d91f18e5b1644afb31889e33">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/CaptainStaplerz" class="author">CaptainStaplerz</a>
</strong>

    commented

    <a href="#issuecomment-98845169" class="timestamp">
<time datetime="2015-05-04T20:44:00Z" is="relative-time">May 4, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> Here's the code where I declare the hooks:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">...</span>
<span class="pl-k">var</span> TodoSchema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
  name<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">String</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span>},
  note<span class="pl-k">:</span> <span class="pl-c1">String</span>,
  completed<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-c1">false</span>},
  updatedAt<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Date</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-smi">Date</span>.<span class="pl-smi">now</span>},
  user<span class="pl-k">:</span> {
    type<span class="pl-k">:</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">ObjectId</span>,
    ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Users<span class="pl-pds">'</span></span>
  }
});
<span class="pl-k">...</span>
<span class="pl-c">// Not executed</span>
<span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>update<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt<span class="pl-pds">'</span></span>)
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
});
<span class="pl-c">// Not executed</span>
<span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt<span class="pl-pds">'</span></span>)
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
});</pre></div>
<p>And here's where I call the update:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">...</span>
<span class="pl-smi">router</span>.<span class="pl-en">route</span>(<span class="pl-s"><span class="pl-pds">'</span>/:id<span class="pl-pds">'</span></span>)
.<span class="pl-en">put</span>(<span class="pl-k">function</span>(<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {
  <span class="pl-smi">TodoModel</span>.<span class="pl-en">findOneAndUpdate</span>({_id<span class="pl-k">:</span> <span class="pl-smi">req</span>.<span class="pl-smi">params</span>.<span class="pl-c1">id</span>, user<span class="pl-k">:</span> <span class="pl-smi">req</span>.<span class="pl-smi">user</span>.<span class="pl-c1">id</span>}, <span class="pl-smi">req</span>.<span class="pl-c1">body</span>, {new<span class="pl-k">:</span> <span class="pl-c1">true</span>}, <span class="pl-k">function</span>(<span class="pl-smi">err</span>, <span class="pl-smi">post</span>) {
    <span class="pl-k">if</span>(err) <span class="pl-k">return</span> <span class="pl-en">next</span>(err);
    <span class="pl-k">if</span>(post) {
      <span class="pl-smi">res</span>.<span class="pl-c1">status</span>(<span class="pl-c1">200</span>).<span class="pl-en">json</span>(post);
    }
    <span class="pl-k">else</span> {
      <span class="pl-en">next</span>(<span class="pl-en">newSystemError</span>(<span class="pl-smi">errorCodes</span>.<span class="pl-c1">TODO_NOT_FOUND</span>, <span class="pl-c1">undefined</span>, <span class="pl-smi">req</span>.<span class="pl-smi">params</span>.<span class="pl-c1">id</span>));
    }
  });
});</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99203386" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="610538ccfdd3267a43d85d7b35ead192">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-99203386" class="timestamp">
<time datetime="2015-05-05T19:59:38Z" is="relative-time">May 5, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>As far as I know the <code>findOneAndUpdate()</code> hook should be in there, if it's not working that's a bug</p>
<p><a href="https://github.com/CaptainStaplerz" class="user-mention">@CaptainStaplerz</a> try:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>update<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">next</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt<span class="pl-pds">'</span></span>)
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
  <span class="pl-en">next</span>();
});</pre></div>
<p>Also, is the <code>console.log</code> statement executing, or is it just the Date.now() part that's giving unexpected results?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/honitus"><img alt="@honitus" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/11481768?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99204344" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7489ca70c3ba1268333b36cce00c38d2">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/honitus" class="author">honitus</a>
</strong>

    commented

    <a href="#issuecomment-99204344" class="timestamp">
<time datetime="2015-05-05T20:02:51Z" is="relative-time">May 5, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> <br />
I changed my source code, adding the changes you made in Add implementation <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964</a> <a href="https://github.com/Automattic/mongoose/commit/e98ef98e857965c4b2ae3339fdd7eefd2a5a9913" class="commit-link"><tt>e98ef98</tt></a></p>
<p>It works like charm now. So I think the fix is not checked into main</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99207014" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="b0d7fc8ed7d46714effc965d2f40aeba">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-99207014" class="timestamp">
<time datetime="2015-05-05T20:11:41Z" is="relative-time">May 5, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/honitus" class="user-mention">@honitus</a> are you sure you're using mongoose 4.0.2? That change is in fact committed to 4.0.0 and up.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/honitus"><img alt="@honitus" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/11481768?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99207963" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="677d4ec743d02764214581776105b46f">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/honitus" class="author">honitus</a>
</strong>

    commented

    <a href="#issuecomment-99207963" class="timestamp">
<time datetime="2015-05-05T20:13:08Z" is="relative-time">May 5, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>honitus$ npm view mongoose version<br />
4.0.2</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99235658" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="5c9a8fae4bf28357b09c6701d46b9624">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-99235658" class="timestamp">
<time datetime="2015-05-05T22:02:34Z" is="relative-time">May 5, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/honitus" class="user-mention">@honitus</a> what you're doing incorrectly is that you're adding hooks to the schema <strong>after</strong> compiling your model. <code>Model.schema.pre('remove');</code> is not expected to work, see <a href="http://mongoosejs.com/docs/models.html">"Compiling your first model" on the model docs</a>. Attach the hooks to the schema first and then things should work - that's the only difference I see between your code and our tests.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99241511" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="b7b621b6c0c64f3e23378f6e491d5260">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-99241511" class="timestamp">
<time datetime="2015-05-05T22:08:28Z" is="relative-time">May 5, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/CaptainStaplerz" class="user-mention">@CaptainStaplerz</a> the only way I can find to repro your code is with an empty update. The below code works</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> mongoose <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>mongoose<span class="pl-pds">'</span></span>);
<span class="pl-smi">mongoose</span>.<span class="pl-en">set</span>(<span class="pl-s"><span class="pl-pds">'</span>debug<span class="pl-pds">'</span></span>, <span class="pl-c1">true</span>);
<span class="pl-k">var</span> util <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>util<span class="pl-pds">'</span></span>);

<span class="pl-smi">mongoose</span>.<span class="pl-en">connect</span>(<span class="pl-s"><span class="pl-pds">'</span>mongodb://localhost:27017/gh964<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> TodoSchema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
  name<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">String</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span>},
  note<span class="pl-k">:</span> <span class="pl-c1">String</span>,
  completed<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-c1">false</span>},
  updatedAt<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Date</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-smi">Date</span>.<span class="pl-smi">now</span>},
  user<span class="pl-k">:</span> {
    type<span class="pl-k">:</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">ObjectId</span>,
    ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Users<span class="pl-pds">'</span></span>
  }
});
<span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>update<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt<span class="pl-pds">'</span></span>)
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
});
<span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt<span class="pl-pds">'</span></span>)
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
});

<span class="pl-k">var</span> Todo <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-en">model</span>(<span class="pl-s"><span class="pl-pds">'</span>Todo<span class="pl-pds">'</span></span>, TodoSchema);

<span class="pl-smi">Todo</span>.<span class="pl-en">update</span>({}, { note<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span> }, <span class="pl-k">function</span>(<span class="pl-smi">err</span>) {
  <span class="pl-k">if</span> (err) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
  }
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Done<span class="pl-pds">'</span></span>);
  <span class="pl-smi">process</span>.<span class="pl-en">exit</span>(<span class="pl-c1">0</span>);
});</pre></div>
<p>But once you make the update empty:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> mongoose <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>mongoose<span class="pl-pds">'</span></span>);
<span class="pl-smi">mongoose</span>.<span class="pl-en">set</span>(<span class="pl-s"><span class="pl-pds">'</span>debug<span class="pl-pds">'</span></span>, <span class="pl-c1">true</span>);
<span class="pl-k">var</span> util <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>util<span class="pl-pds">'</span></span>);

<span class="pl-smi">mongoose</span>.<span class="pl-en">connect</span>(<span class="pl-s"><span class="pl-pds">'</span>mongodb://localhost:27017/gh964<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> TodoSchema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
  name<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">String</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span>},
  note<span class="pl-k">:</span> <span class="pl-c1">String</span>,
  completed<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-c1">false</span>},
  updatedAt<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Date</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-smi">Date</span>.<span class="pl-smi">now</span>},
  user<span class="pl-k">:</span> {
    type<span class="pl-k">:</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">ObjectId</span>,
    ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Users<span class="pl-pds">'</span></span>
  }
});
<span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>update<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt<span class="pl-pds">'</span></span>)
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
});
<span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt<span class="pl-pds">'</span></span>)
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
});

<span class="pl-k">var</span> Todo <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-en">model</span>(<span class="pl-s"><span class="pl-pds">'</span>Todo<span class="pl-pds">'</span></span>, TodoSchema);

<span class="pl-smi">Todo</span>.<span class="pl-en">update</span>({}, { }, <span class="pl-k">function</span>(<span class="pl-smi">err</span>) {
  <span class="pl-k">if</span> (err) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
  }
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Done<span class="pl-pds">'</span></span>);
  <span class="pl-smi">process</span>.<span class="pl-en">exit</span>(<span class="pl-c1">0</span>);
});</pre></div>
<p>The pre update hook no longer executes. Is this consistent with what you're seeing?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/honitus"><img alt="@honitus" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/11481768?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99264168" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="6ae7301fea5716a5db2eccc59ab1d0b1">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/honitus" class="author">honitus</a>
</strong>

    commented

    <a href="#issuecomment-99264168" class="timestamp">
<time datetime="2015-05-05T23:53:38Z" is="relative-time">May 5, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> <br />
Model.schema.pre('remove'); is one the stubs automatically created by angular full stack<br />
I added implementation <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#964</a> <a href="https://github.com/Automattic/mongoose/commit/e98ef98e857965c4b2ae3339fdd7eefd2a5a9913" class="commit-link"><tt>e98ef98</tt></a> <br />
All I did is add one line below<br />
this.<em>schema.s</em>.hooks.wrap('findOneAndUpdate', Query.base.findOneAndUpdate,<br />
See Line 1526 in 4.0.2 - this.model.hooks.wrap('findOneAndUpdate', Query.base.findOneAndUpdate,</p>
<p>Replace Line 1526 with-  this.schema.s.hooks.wrap('findOneAndUpdate', Query.base.findOneAndUpdate,<br />
and it works.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99463346" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="aebc46cdcd18e7994b5fe862071c8bcd">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-99463346" class="timestamp">
<time datetime="2015-05-06T13:40:18Z" is="relative-time">May 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>That's by design. Mongoose is not supposed to allow modifying the schema hooks after the model has been compiled (that is, the <code>mongoose.model()</code> call), which is why that no longer works.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/CaptainStaplerz"><img alt="@CaptainStaplerz" class="timeline-comment-avatar" height="48" src="https://avatars3.githubusercontent.com/u/11563478?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99602396" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="614a2684aea01744f4c5894a58408db5">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/CaptainStaplerz" class="author">CaptainStaplerz</a>
</strong>

    commented

    <a href="#issuecomment-99602396" class="timestamp">
<time datetime="2015-05-06T20:38:57Z" is="relative-time">May 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> I managed to get the hook working now with the following, it must have been a stupid typo or something else:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">next</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>-------------&gt;&gt;&gt;&gt;&gt;&gt; update updatedAt: <span class="pl-pds">'</span></span>, <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span>);
  <span class="pl-v">this</span>.<span class="pl-smi">updatedAt</span> <span class="pl-k">=</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>();
  <span class="pl-en">next</span>();
});</pre></div>
<p>However 'this' doesn't seem to refer to the updated model (but it does in the 'save' hook?), thereby this.updatedAt refers to undefined.</p>
<p>How do I update the 'updatedAt' -field in the 'findOneAndUpdate' -hook?</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-73754866">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

      referenced
      this issue
      <a class="timestamp" href="#ref-issue-73754866">
<time datetime="2015-05-06T22:23:17Z" is="relative-time">May 6, 2015</time>
</a>
</div>
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Closed
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/Automattic/mongoose/issues/2974" class="title-link">
        docs; clarify context for query middleware
        <span class="issue-num">#2974</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99629270" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="d14513bc8c06e673715cc742598940e2">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-99629270" class="timestamp">
<time datetime="2015-05-06T22:24:37Z" is="relative-time">May 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>I should add more docs clarifying this - the document that's being updated may not exist in memory when you call <code>findOneAndUpdate</code>, so the <code>this</code> object refers to the <strong>query</strong> rather than the <strong>document</strong> in <a href="http://mongoosejs.com/docs/middleware.html">query middleware</a>. Try <code>this.update({ $set: { updatedAt: Date.now() } });</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-closed">
<div class="discussion-item-header" id="event-298705954">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-circle-slash"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      closed this   <a href="https://github.com/Automattic/mongoose/issues/964#event-298705954" class="timestamp"><time class="timestamp" datetime="2015-05-06T22:24:37Z" is="relative-time">May 6, 2015</time></a>
</div>
</div>
<div class="closed-banner"></div>
<div class="discussion-item discussion-item-demilestoned">
<div class="discussion-item-header" id="event-298706109">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-milestone"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      removed this from the <a href="http://github.com/Automattic/mongoose/milestones/4.0.3" class="discussion-item-entity">4.0.3</a> milestone <a href="https://github.com/Automattic/mongoose/issues/964#event-298706109" class="timestamp"><time class="timestamp" datetime="2015-05-06T22:24:55Z" is="relative-time">May 6, 2015</time></a>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/aggied"><img alt="@aggied" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/4122815?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99742552" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="e415887c82f6e0f555a048f44689bdaa">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/aggied" class="author">aggied</a>
</strong>

    commented

    <a href="#issuecomment-99742552" class="timestamp">
<time datetime="2015-05-07T06:43:18Z" is="relative-time">May 7, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> I could not get <code>this.update({ $set: { updatedAt: Date.now() } });</code> to work, but I was able to successfully update the doc on the <code>findOneAndUpdate</code> hook with this: <code>this._update['$setOnInsert'].updatedAt=Date.now();</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99891721" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="b407a2f8de7f18e1c46c06b32022af39">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-99891721" class="timestamp">
<time datetime="2015-05-07T14:41:17Z" is="relative-time">May 7, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>I would highly recommend not depending on tweaking internal state like that. I'm pretty surprised that you couldn't get <code>this.update()</code> to work - can you show me what your hook looks like?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/aggied"><img alt="@aggied" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/4122815?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-99932452" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="d17eba3ea62258164b45db1556fc5399">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/aggied" class="author">aggied</a>
</strong>

    commented

    <a href="#issuecomment-99932452" class="timestamp">
<time datetime="2015-05-07T16:38:06Z" is="relative-time">May 7, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Sure! (Note that I'm using 4.0.2)</p>
<pre><code>tagSchema.pre('findOneAndUpdate',function(next){
  var self = this;

  //NOTE THAT 'this' in the findOneAndUpdate hook refers to the query, not the document
  //https://github.com/Automattic/mongoose/issues/964

  geoData.country.findOne({'_id':self._update['$setOnInsert'].countryCode}).select('_id name cca2 cca3 ccn3').lean().exec(function(err,country){
    if (err){throw err;}
    if (!country){throw 'no coutnry';}
    self._update['$setOnInsert'].country=country;
    next();
  });
});
</code></pre>
<p>I could obviously handle this when I initialize the document elsewhere in my app, but it's nice to have it all contained right there in Mongoose. Welcome any thoughts!</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-reopened">
<div class="discussion-item-header" id="event-299480218">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-primitive-dot"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      reopened this   <a href="https://github.com/Automattic/mongoose/issues/964#event-299480218" class="timestamp"><time class="timestamp" datetime="2015-05-07T17:03:43Z" is="relative-time">May 7, 2015</time></a>
</div>
</div>
<div class="discussion-item discussion-item-milestoned">
<div class="discussion-item-header" id="event-299480265">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-milestone"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      added this to the <a href="http://github.com/Automattic/mongoose/milestones/4.0.3" class="discussion-item-entity">4.0.3</a> milestone <a href="https://github.com/Automattic/mongoose/issues/964#event-299480265" class="timestamp"><time class="timestamp" datetime="2015-05-07T17:03:48Z" is="relative-time">May 7, 2015</time></a>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-100011849" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="e4ea83843eb9f06814b30b487e5e6fa5">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-100011849" class="timestamp">
<time datetime="2015-05-07T20:38:48Z" is="relative-time">May 7, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Yeah I was confused and thought you were using <code>update</code>. The below script</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> mongoose <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>mongoose<span class="pl-pds">'</span></span>);
<span class="pl-smi">mongoose</span>.<span class="pl-en">set</span>(<span class="pl-s"><span class="pl-pds">'</span>debug<span class="pl-pds">'</span></span>, <span class="pl-c1">true</span>);
<span class="pl-k">var</span> util <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>util<span class="pl-pds">'</span></span>);

<span class="pl-smi">mongoose</span>.<span class="pl-en">connect</span>(<span class="pl-s"><span class="pl-pds">'</span>mongodb://localhost:27017/gh964<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> TodoSchema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
  name<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">String</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span>},
  note<span class="pl-k">:</span> <span class="pl-c1">String</span>,
  completed<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Boolean</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-c1">false</span>},
  updatedAt<span class="pl-k">:</span> {type<span class="pl-k">:</span> <span class="pl-c1">Date</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-smi">Date</span>.<span class="pl-smi">now</span>},
  user<span class="pl-k">:</span> {
    type<span class="pl-k">:</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">ObjectId</span>,
    ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Users<span class="pl-pds">'</span></span>
  }
});
<span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-v">this</span>.<span class="pl-en">findOneAndUpdate</span>({}, { updatedAt<span class="pl-k">:</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>() });
});

<span class="pl-k">var</span> Todo <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-en">model</span>(<span class="pl-s"><span class="pl-pds">'</span>Todo<span class="pl-pds">'</span></span>, TodoSchema);

<span class="pl-smi">Todo</span>.<span class="pl-en">findOneAndUpdate</span>({}, { note<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span> }, <span class="pl-k">function</span>(<span class="pl-smi">err</span>) {
  <span class="pl-k">if</span> (err) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(err);
  }
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Done<span class="pl-pds">'</span></span>);
  <span class="pl-smi">process</span>.<span class="pl-en">exit</span>(<span class="pl-c1">0</span>);
});</pre></div>
<p>Works correctly and executes the desired query:</p>
<pre><code>Mongoose: todos.findAndModify({}) [] { '$set': { note: '1', updatedAt: new Date("Thu, 07 May 2015 20:36:39 GMT") } } { new: false, upsert: false }
Done
</code></pre>
<p>So please use</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-v">this</span>.<span class="pl-en">findOneAndUpdate</span>({}, { updatedAt<span class="pl-k">:</span> <span class="pl-smi">Date</span>.<span class="pl-en">now</span>() });
});</pre></div>
<p>Instead of manually manipulating mquery's internal state - that's usually a bad idea unless you really really know what you're doing.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-closed">
<div class="discussion-item-header" id="event-299673851">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-circle-slash"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      closed this   <a href="https://github.com/Automattic/mongoose/issues/964#event-299673851" class="timestamp"><time class="timestamp" datetime="2015-05-07T20:38:48Z" is="relative-time">May 7, 2015</time></a>
</div>
</div>
<div class="closed-banner"></div>
<div class="discussion-item discussion-item-demilestoned">
<div class="discussion-item-header" id="event-299673914">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-milestone"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
      removed this from the <a href="http://github.com/Automattic/mongoose/milestones/4.0.3" class="discussion-item-entity">4.0.3</a> milestone <a href="https://github.com/Automattic/mongoose/issues/964#event-299673914" class="timestamp"><time class="timestamp" datetime="2015-05-07T20:38:52Z" is="relative-time">May 7, 2015</time></a>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/agjs"><img alt="@agjs" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/7226555?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-116785563" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="51d51281d35820c6caefad7d3d3335f8">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/agjs" class="author">agjs</a>
</strong>

    commented

    <a href="#issuecomment-116785563" class="timestamp">
<time datetime="2015-06-29T18:26:30Z" is="relative-time">Jun 29, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Is this working or not ? Only hook that works for me is 'save', rest is completely ignored. I'm running on 4.0.6. Thanks </p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-116827460" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="8a9bd314957e98ef378783c63a8f74ab">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-116827460" class="timestamp">
<time datetime="2015-06-29T20:15:32Z" is="relative-time">Jun 29, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/agjs" class="user-mention">@agjs</a> provide code example please.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/agjs"><img alt="@agjs" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/7226555?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-116830290" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="b931c15fc69fab5641309ce25b4942c4">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/agjs" class="author">agjs</a>
</strong>

    commented

    <a href="#issuecomment-116830290" class="timestamp">
<time datetime="2015-06-29T20:21:51Z" is="relative-time">Jun 29, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<div class="highlight highlight-source-js"><pre><span class="pl-c1">UserController</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">updateAvatar</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">resolve</span>, <span class="pl-smi">reject</span>) {
        <span class="pl-smi">CompanyDetails</span>.<span class="pl-en">update</span>({
            _author<span class="pl-k">:</span> <span class="pl-smi">req</span>.<span class="pl-smi">user</span>.<span class="pl-smi">_id</span>
        }, {
            avatarPath<span class="pl-k">:</span> <span class="pl-smi">req</span>.<span class="pl-smi">files</span>.<span class="pl-smi">file</span>
        }, <span class="pl-k">function</span> (<span class="pl-smi">error</span>, <span class="pl-smi">updated</span>) {
            <span class="pl-k">if</span> (error) {
                <span class="pl-en">reject</span>(error);
            } <span class="pl-k">else</span> {
                <span class="pl-en">resolve</span>(updated);
            }
        });
    }).<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">resolved</span>) {
        <span class="pl-smi">res</span>.<span class="pl-en">sendStatus</span>(<span class="pl-c1">204</span>).<span class="pl-c1">send</span>(updated);
    }).<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
        <span class="pl-en">next</span>(error);
    })

};
</pre></div>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>update<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">next</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>pre save<span class="pl-pds">'</span></span>);
    <span class="pl-k">let</span> VirtualModel <span class="pl-k">=</span> <span class="pl-v">this</span>,
        parent <span class="pl-k">=</span> <span class="pl-v">this</span>.<span class="pl-c1">ownerDocument</span>(),
        <span class="pl-c1">PATH</span> <span class="pl-k">=</span> <span class="pl-smi">path</span>.<span class="pl-en">normalize</span>(<span class="pl-s"><span class="pl-pds">'</span>./public/images/uploads/avatars/<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-smi">parent</span>.<span class="pl-smi">_id</span>);

    <span class="pl-en">mkdirp</span>(<span class="pl-c1">PATH</span>, <span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
        <span class="pl-k">if</span> (error) {
            <span class="pl-en">next</span>(error);
        } <span class="pl-k">else</span> {
            <span class="pl-smi">fs</span>.<span class="pl-en">rename</span>(<span class="pl-smi">VirtualModel</span>.<span class="pl-smi">path</span>, <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">PATH</span>, <span class="pl-smi">VirtualModel</span>.<span class="pl-c1">name</span>), <span class="pl-k">function</span> (<span class="pl-smi">error2</span>) {
                <span class="pl-k">if</span> (error2) {
                    <span class="pl-en">next</span>(error2);
                } <span class="pl-k">else</span> {
                    <span class="pl-en">next</span>();
                }
            });
        }
    });

});
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/agjs"><img alt="@agjs" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/7226555?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-116846592" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="737c8d16b3301ffbda937ee57b135234">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/agjs" class="author">agjs</a>
</strong>

    commented

    <a href="#issuecomment-116846592" class="timestamp">
<time datetime="2015-06-29T21:07:12Z" is="relative-time">Jun 29, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>I have another pre-hook on another model with model.create and pre-save and it works normally.</p>
<p>With update whatsoever, It simply doesn't see the hook, doesn't even console.log it. I tried findOneAndUpdate too etc, doesn't really work... Funny thing I've went through this entire thread and as I usually do, checked official documentation and you guys claim even there that it works. </p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-116885452" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="7299edce07fed51b24b1b5a6e9602c40">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-116885452" class="timestamp">
<time datetime="2015-06-30T00:18:58Z" is="relative-time">Jun 30, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>What's the relationship between CompanyAvatarSchema and CompanyDetails in the above code?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/agjs"><img alt="@agjs" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/7226555?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-117043712" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="47cd207a07cd3404d8461ad0bb0cb4fd">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/agjs" class="author">agjs</a>
</strong>

    commented

    <a href="#issuecomment-117043712" class="timestamp">
<time datetime="2015-06-30T07:48:40Z" is="relative-time">Jun 30, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Company details have CompanyAvatar.schema as a subdocument </p>
<div class="highlight highlight-source-js"><pre>avatarPath<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> [<span class="pl-smi">CompanyAvatar</span>.<span class="pl-smi">schema</span>],
        required<span class="pl-k">:</span> <span class="pl-c1">true</span>
    }</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/agjs"><img alt="@agjs" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/7226555?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-117053444" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="1fdae0cee2349d0dc28042d7daf4f383">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/agjs" class="author">agjs</a>
</strong>

    commented

    <a href="#issuecomment-117053444" class="timestamp">
<time datetime="2015-06-30T08:28:16Z" is="relative-time">Jun 30, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Also, its not only pre-hook but validation gets ignored completely as well. This subdocument gets populated but ignores both, validation and pre-hook. I've googled everything, also tried <a href="https://www.mongodb.com/blog/post/introducing-version-40-mongoose-nodejs-odm">THIS</a> but nothing seams to work. When I just for test change my query to create and invoke model with <strong>new</strong> aka var parent = new Parent(), it does work. </p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-92067037">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@alexbooker" class="avatar" height="16" src="https://avatars3.githubusercontent.com/u/11927968?v=3&amp;s=32" width="16" />
<a href="http://github.com/alexbooker" class="author" truncate="true">alexbooker</a>

      referenced
      this issue
        in <strong>arkcore/activator</strong>
<a class="timestamp" href="#ref-issue-92067037">
<time datetime="2015-06-30T11:28:55Z" is="relative-time">Jun 30, 2015</time>
</a>
</div>
<span class="state state-open right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Open
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/arkcore/activator/issues/8" class="title-link">
        How should I handle password hashing for the password reset middleware?
        <span class="issue-num">#8</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-117230344" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="e0702d4c382c9e8b7049c47ba503a542">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-117230344" class="timestamp">
<time datetime="2015-06-30T15:33:45Z" is="relative-time">Jun 30, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>You're calling <code>CompanyDetails.update()</code> but the pre hook is defined on a separate schema. Query middleware doesn't fire the nested schema's <code>pre('update')</code> atm.</p>
<p>Also, please provide a more thorough code example for your 'validation gets ignored completely' case as well.</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-92125999">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

      referenced
      this issue
      <a class="timestamp" href="#ref-issue-92125999">
<time datetime="2015-06-30T15:34:22Z" is="relative-time">Jun 30, 2015</time>
</a>
</div>
<span class="state state-open right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Open
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/Automattic/mongoose/issues/3125" class="title-link">
        Fire nested schema query middleware when updating
        <span class="issue-num">#3125</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/agjs"><img alt="@agjs" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/7226555?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-117603462" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="f933e2f2b561911949d2245ba2eb1d00">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/agjs" class="author">agjs</a>
</strong>

    commented

    <a href="#issuecomment-117603462" class="timestamp">
<time datetime="2015-07-01T10:54:50Z" is="relative-time">Jul 1, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Here is my company avatar schema made for validation and pre-hooks for users who are updating their profile (avatar photo): </p>
<div class="highlight highlight-source-js"><pre><span class="pl-s"><span class="pl-pds">'</span>use strict<span class="pl-pds">'</span></span>;

<span class="pl-k">let</span> mongoose <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>mongoose<span class="pl-pds">'</span></span>),
    mkdirp <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>mkdirp<span class="pl-pds">'</span></span>),
    fs <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>fs<span class="pl-pds">'</span></span>),
    path <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>),
    Schema <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>;

<span class="pl-k">let</span> CompanyAvatarSchema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Schema</span>({
    name<span class="pl-k">:</span> <span class="pl-c1">String</span>,
    width<span class="pl-k">:</span> <span class="pl-c1">Number</span>,
    height<span class="pl-k">:</span> <span class="pl-c1">Number</span>,
    size<span class="pl-k">:</span> <span class="pl-c1">Number</span>,
    type<span class="pl-k">:</span> <span class="pl-c1">String</span>
});


<span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">path</span>(<span class="pl-s"><span class="pl-pds">'</span>type<span class="pl-pds">'</span></span>).<span class="pl-en">validate</span>(<span class="pl-k">function</span> (<span class="pl-smi">type</span>) {
    <span class="pl-k">return</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span>image<span class="pl-cce">\/</span><span class="pl-pds">/</span></span>.<span class="pl-c1">test</span>(type);
}, <span class="pl-s"><span class="pl-pds">'</span>Image type not allowed!<span class="pl-pds">'</span></span>);

<span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">path</span>(<span class="pl-s"><span class="pl-pds">'</span>size<span class="pl-pds">'</span></span>).<span class="pl-en">validate</span>(<span class="pl-k">function</span> (<span class="pl-smi">size</span>) {
    <span class="pl-k">return</span> size <span class="pl-k">&lt;</span> <span class="pl-c1">5</span>;
}, <span class="pl-s"><span class="pl-pds">'</span>Image too big!<span class="pl-pds">'</span></span>);



<span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">virtual</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-en">set</span>(<span class="pl-k">function</span> (<span class="pl-smi">path</span>) {
    <span class="pl-k">return</span> <span class="pl-v">this</span>.<span class="pl-smi">_path</span> <span class="pl-k">=</span> path;
}).<span class="pl-en">get</span>(<span class="pl-k">function</span> () {
    <span class="pl-k">return</span> <span class="pl-v">this</span>.<span class="pl-smi">_path</span>;
});


<span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">virtual</span>(<span class="pl-s"><span class="pl-pds">'</span>public_path<span class="pl-pds">'</span></span>).<span class="pl-en">get</span>(<span class="pl-k">function</span> () {
    <span class="pl-k">var</span> parent <span class="pl-k">=</span> <span class="pl-v">this</span>.<span class="pl-c1">ownerDocument</span>();
    <span class="pl-k">var</span> <span class="pl-c1">PATH</span> <span class="pl-k">=</span> <span class="pl-smi">path</span>.<span class="pl-en">normalize</span>(<span class="pl-s"><span class="pl-pds">'</span>images/uploads/avatars/<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-smi">parent</span>.<span class="pl-smi">_id</span>);
    <span class="pl-k">if</span> (<span class="pl-v">this</span>.<span class="pl-c1">name</span>) {
        <span class="pl-k">return</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">PATH</span>, <span class="pl-v">this</span>.<span class="pl-c1">name</span>);
    }
});

<span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">set</span>(<span class="pl-s"><span class="pl-pds">'</span>toJSON<span class="pl-pds">'</span></span>, {
    getters<span class="pl-k">:</span> <span class="pl-c1">true</span>
});

<span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">next</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>pre save<span class="pl-pds">'</span></span>);
    <span class="pl-k">let</span> VirtualModel <span class="pl-k">=</span> <span class="pl-v">this</span>,
        parent <span class="pl-k">=</span> <span class="pl-v">this</span>.<span class="pl-c1">ownerDocument</span>(),
        <span class="pl-c1">PATH</span> <span class="pl-k">=</span> <span class="pl-smi">path</span>.<span class="pl-en">normalize</span>(<span class="pl-s"><span class="pl-pds">'</span>./public/images/uploads/avatars/<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-smi">parent</span>.<span class="pl-smi">_id</span>);

    <span class="pl-en">mkdirp</span>(<span class="pl-c1">PATH</span>, <span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
        <span class="pl-k">if</span> (error) {
            <span class="pl-en">next</span>(error);
        } <span class="pl-k">else</span> {
            <span class="pl-smi">fs</span>.<span class="pl-en">rename</span>(<span class="pl-smi">VirtualModel</span>.<span class="pl-smi">path</span>, <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">PATH</span>, <span class="pl-smi">VirtualModel</span>.<span class="pl-c1">name</span>), <span class="pl-k">function</span> (<span class="pl-smi">error2</span>) {
                <span class="pl-k">if</span> (error2) {
                    <span class="pl-en">next</span>(error2);
                } <span class="pl-k">else</span> {
                    <span class="pl-en">next</span>();
                }
            });
        }
    });

});


<span class="pl-k">let</span> <span class="pl-en">runValidatorsPlugin</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">schema</span>, <span class="pl-smi">options</span>) {
    <span class="pl-smi">schema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">next</span>) {
        <span class="pl-v">this</span>.<span class="pl-c1">options</span>.<span class="pl-smi">runValidators</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;
        <span class="pl-en">next</span>();
    });
};

<span class="pl-smi">CompanyAvatarSchema</span>.<span class="pl-en">plugin</span>(runValidatorsPlugin);

<span class="pl-k">let</span> CompanyAvatar <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-en">model</span>(<span class="pl-s"><span class="pl-pds">'</span>CompanyAvatar<span class="pl-pds">'</span></span>, CompanyAvatarSchema);
<span class="pl-smi">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> CompanyAvatar;</pre></div>
<p>Here is the company_details schema where company_avatar is a subdocument :</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">let</span> CompanyDetailsSchema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    _author<span class="pl-k">:</span> [{
        type<span class="pl-k">:</span> <span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>.<span class="pl-smi">ObjectId</span>,
        ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>CompanyAccount<span class="pl-pds">'</span></span>
    }],
    company_name<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">String</span>,
        es_indexed<span class="pl-k">:</span> <span class="pl-c1">true</span>,
        es_boost<span class="pl-k">:</span> <span class="pl-c1">2.0</span>
    },
    contact_email<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">String</span>,
        es_indexed<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    website<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">String</span>,
        es_indexed<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    country<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">String</span>,
        es_indexed<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    industry<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">String</span>,
        es_indexed<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    address<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">String</span>,
        es_indexed<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    about<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">String</span>,
        es_indexed<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    avatarPath<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> [<span class="pl-smi">CompanyAvatar</span>.<span class="pl-smi">schema</span>],

    }
});</pre></div>
<p>And here is update profile controller and the avatarPath which should be validated / hooked before this update performs:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c1">UserController</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">updateAvatar</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>, <span class="pl-smi">next</span>) {
    <span class="pl-k">let</span> updates <span class="pl-k">=</span> {
        $set<span class="pl-k">:</span> {
            avatarPath<span class="pl-k">:</span> <span class="pl-smi">req</span>.<span class="pl-smi">files</span>.<span class="pl-smi">file</span>
        }
    };
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">resolve</span>, <span class="pl-smi">reject</span>) {
        <span class="pl-smi">CompanyDetails</span>.<span class="pl-en">findOneAndUpdate</span>({
            _author<span class="pl-k">:</span> <span class="pl-smi">req</span>.<span class="pl-smi">user</span>.<span class="pl-smi">_id</span>
        }, updates, <span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
            <span class="pl-k">if</span> (error) {
                <span class="pl-en">reject</span>(error);
            } <span class="pl-k">else</span> {
                <span class="pl-en">resolve</span>(<span class="pl-s"><span class="pl-pds">'</span>done<span class="pl-pds">'</span></span>);
            }
        });
    }).<span class="pl-en">then</span>(<span class="pl-k">function</span> () {
        <span class="pl-smi">res</span>.<span class="pl-en">sendStatus</span>(<span class="pl-c1">204</span>);
    }).<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
        <span class="pl-en">next</span>(error);
    });

};</pre></div>
<p>Basically, my mongodb gets populated with the fields from req.files.file but other then that, validation gets ignored and no hooks are working. </p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-119970303" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="1c494d6f6e18bcf1f92f952d7f222970">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-119970303" class="timestamp">
<time datetime="2015-07-09T13:42:01Z" is="relative-time">Jul 9, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>The issue is that the pre('findOneAndUpdate') middleware is defined on a nested schema. Right now, mongoose only fires query middleware for top level schemas, so middlewares defined on <code>CompanyDetailsSchema</code> will get fired re: <a href="https://github.com/Automattic/mongoose/issues/3125" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/3125" data-id="92125999" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#3125</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-pullrequest-105179087">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@isayme" class="avatar" height="16" src="https://avatars1.githubusercontent.com/u/1747852?v=3&amp;s=32" width="16" />
<a href="http://github.com/isayme" class="author" truncate="true">isayme</a>

      referenced
      this issue
        in <strong>mongoosastic/mongoosastic</strong>
<a class="timestamp" href="#ref-pullrequest-105179087">
<time datetime="2015-09-07T09:12:58Z" is="relative-time">Sep 7, 2015</time>
</a>
</div>
<span class="state state-merged right">
<span aria-hidden="true" class="octicon octicon-git-pull-request"></span>
        Merged
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/mongoosastic/mongoosastic/issues/97" class="title-link">
        index/unindex when findOneAndUpdate/findOneAndRemove
        <span class="issue-num">#97</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/w3hacker"><img alt="@w3hacker" class="timeline-comment-avatar" height="48" src="https://avatars0.githubusercontent.com/u/4545879?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-139737750" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="7015440590904d38e35615ff0672d21c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/w3hacker" class="author">w3hacker</a>
</strong>

    commented

    <a href="#issuecomment-139737750" class="timestamp">
<time datetime="2015-09-12T07:10:58Z" is="relative-time">Sep 12, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>+1</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-commit-739a7bd">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@loiclefloch" class="avatar" height="16" src="https://avatars3.githubusercontent.com/u/3998603?v=3&amp;s=32" width="16" />
<a href="http://github.com/loiclefloch" class="author" truncate="true">loiclefloch</a>

        added a commit
          to loiclefloch/bookmark-manager
        that referenced
        this issue

      <a href="#ref-commit-739a7bd" class="timestamp">
<time datetime="2015-09-20T15:19:14Z" is="relative-time">Sep 20, 2015</time>
</a>
</div>
<table class="timeline-commits">
<tr class="commit js-details-container js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:commit:739a7bda918886c1c46836f905a279f5830cf61d" data-url="/Automattic/mongoose/commit/739a7bda918886c1c46836f905a279f5830cf61d/show_partial?partial=commit%2Fcondensed">
<td class="commit-icon">
<span aria-hidden="true" class="octicon octicon-git-commit"></span>
</td>
<td class="commit-gravatar">
<a href="http://github.com/loiclefloch"><img alt="@loiclefloch" class="avatar avatar-small" height="16" src="https://avatars3.githubusercontent.com/u/3998603?v=3&amp;s=32" width="16" /></a>
</td>
<td class="commit-author">
<strong><a href="http://github.com/loiclefloch" class="author" rel="contributor">loiclefloch</a></strong>
</td>
<td class="commit-message">
<code><a href="http://github.com/loiclefloch/bookmark-manager/commit/739a7bda918886c1c46836f905a279f5830cf61d" class="message" data-pjax="true" title="fix(Api Bookmark): notify websocket when update a bookmark

Change findOneAndUpdate by findOne and save because findOneAndUpdate and update are
executed  directly in the database, so it broke the websocket events handling.
cf https://github.com/Automattic/mongoose/issues/964">fix(Api Bookmark): notify websocket when update a bookmark</a></code>
<span class="hidden-text-expander inline">
<a href="#" class="js-details-target">&hellip;</a>
</span>
<div class="commit-desc"><pre class="text-small">Change findOneAndUpdate by findOne and save because findOneAndUpdate and update are
executed  directly in the database, so it broke the websocket events handling.
cf <a href="https://github.com/Automattic/mongoose/issues/964" class="issue-link js-issue-link" data-url="https://github.com/Automattic/mongoose/issues/964" data-id="5097952" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">Automattic/mongoose#964</a></pre></div>
</td>
<td class="commit-meta">
<code><a href="http://github.com/loiclefloch/bookmark-manager/commit/739a7bda918886c1c46836f905a279f5830cf61d" class="commit-id">739a7bd</a></code>
</td>
</tr>
</table>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
      This was referenced <time datetime="2015-10-22T20:21:52Z" is="relative-time">Oct 22, 2015</time>
</div>
<div class="discussion-item-rollup-ref">
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-closed"></span>
            Closed
          </span>
<div class="discussion-item-header" id="ref-issue-112343364">
<h3 class="discussion-item-ref-title">
<a href="http://github.com/getlackey/mongoose-version/issues/4" class="title-link">
              plugin does not create version objects

              <span class="issue-num">
                getlackey/mongoose-version#4
              </span>
</a> </h3>
</div>
</div>
<div class="discussion-item-rollup-ref">
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-closed"></span>
            Closed
          </span>
<div class="discussion-item-header" id="ref-issue-112045233">
<h3 class="discussion-item-ref-title">
<a href="http://github.com/rawcodeio/Bug-Report/issues/1" class="title-link">
              GitHub importer doesn&#39;t index snippets correctly (in elasticsearch)

              <span class="issue-num">
                rawcodeio/Bug-Report#1
              </span>
</a> </h3>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/willemmulder"><img alt="@willemmulder" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/70933?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154332797" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="174ff777818676bf2a6570913dd5df6c">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/willemmulder" class="author">willemmulder</a>
</strong>

    commented

    <a href="#issuecomment-154332797" class="timestamp">
<time datetime="2015-11-06T07:20:39Z" is="relative-time">Nov 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> I get that </p>
<pre><code>TodoSchema.pre('findOneAndUpdate', function() {
  this.findOneAndUpdate({}, { updatedAt: Date.now() });
});
</code></pre>
<p>works to set a property to a hard value, but how would I <em>read and change</em> a property, e.g. hash a password?</p>
<pre><code>TodoSchema.pre('findOneAndUpdate', function() {
  this.findOneAndUpdate({}, { password: hashPassword(.....?....) });
});
</code></pre>
<p>Any thoughts? This is a pretty common usecase, right? Or do people usually find() and then separate save() ?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154491730" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="4833e6379f245a4c82409c2ee2fcf84b">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-154491730" class="timestamp">
<time datetime="2015-11-06T18:21:04Z" is="relative-time">Nov 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<div class="highlight highlight-source-js"><pre><span class="pl-smi">TodoSchema</span>.<span class="pl-en">pre</span>(<span class="pl-s"><span class="pl-pds">'</span>findOneAndUpdate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-v">this</span>.<span class="pl-en">findOneAndUpdate</span>({}, { password<span class="pl-k">:</span> <span class="pl-en">hashPassword</span>(<span class="pl-v">this</span>.<span class="pl-en">getUpdate</span>().<span class="pl-smi">$set</span>.<span class="pl-smi">password</span>) });
});</pre></div>
<p>That should work <a href="https://github.com/willemmulder" class="user-mention">@willemmulder</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/willemmulder"><img alt="@willemmulder" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/70933?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154520656" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="cb2f9e8230c6ef0821b3ee298f10d1ff">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/willemmulder" class="author">willemmulder</a>
</strong>

    commented

    <a href="#issuecomment-154520656" class="timestamp">
<time datetime="2015-11-06T20:15:47Z" is="relative-time">Nov 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> perfect, thanks! I'll be trying that tonight. That should also work for <code>pre('update')</code> right?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/willemmulder"><img alt="@willemmulder" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/70933?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154546852" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="52304cb2a825ea8633722b1f2b9e3b8e">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/willemmulder" class="author">willemmulder</a>
</strong>

    commented

    <a href="#issuecomment-154546852" class="timestamp">
<time datetime="2015-11-06T21:27:42Z" is="relative-time">Nov 6, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> So I just tried it using </p>
<pre><code>schema.pre('update', function(next) {
this.update({}, { $set : { password: bcrypt.hashSync(this.getUpdate().$set.password) } });
next();
});
</code></pre>
<p>and if I console.log <code>this</code> I do get </p>
<pre lang="_update:"><code>{ '$set':
    { password: '$2a$10$CjLYwXFtx0I94Ij0SImk0O32cyQwsShKnWh1248BpYsJLIHh7jb66',
        postalAddress: [Object],
        permissions: [Object],
        firstName: 'Willem',
        lastName: 'Mulder',
        email: '...@...',
        _id: 55ed4e8b6de4ff183c1f98e8 } },
</code></pre>
<p>which seems fine (and I even tried setting that property directly before) but in the end, it doesn't actually write the hashed value to the database, but simply the 'raw' value. Is there anything I could try?</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154734006" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="0e8cf17096c8e04d4ce26b73aa0442c9">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-154734006" class="timestamp">
<time datetime="2015-11-07T18:23:17Z" is="relative-time">Nov 7, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>That's strange. You can try enabling mongoose debug mode with <code>require('mongoose').set('debug', true);</code> and see what the query that's getting sent to the db is, that could shed some light.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/willemmulder"><img alt="@willemmulder" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/70933?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154743584" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="2d22f0e35b4e12b11570d7198793e85a">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/willemmulder" class="author">willemmulder</a>
</strong>

    commented

    <a href="#issuecomment-154743584" class="timestamp">
<time datetime="2015-11-07T20:02:51Z" is="relative-time">Nov 7, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Thanks for the suggestion. Just did that:</p>
<p>I run this:</p>
<pre><code>schema.pre('update', function(next) {
    this.update({}, { password: bcrypt.hashSync(this.getUpdate().$set.password) } );
    console.log(this.getUpdate());
    next();
});
</code></pre>
<p>which returns this for the console.log</p>
<pre><code>{ '$set':
   { password: '$2a$10$I1oXet30Cl5RUcVMxm3GEOeTFOLFmPWaQvXbr6Z5368zbfpA8nFEK',
     postalAddress: { street: '', houseNumber: '', zipCode: '', city: '', country: '' },
     permissions: [ '' ],
     __v: 0,
     lastName: '',
     firstName: '',
     email: 'test@test.nl',
     _id: 563b0410bd07ce2030eda26d } }
</code></pre>
<p>and then this for the Mongoose debug</p>
<pre><code>Mongoose: users.update({ _id: ObjectId("563b0410bd07ce2030eda26d") }) { '$set': { password: 'test', postalAddress: { street: '', houseNumber: '', zipCode: '', city: '', country: '' }, permissions: [ '\u001b[32m\'\'\u001b[39m' ], __v: 0, lastName: '', firstName: '', email: 'test@test.nl', _id: ObjectId("563b0410bd07ce2030eda26d") } } { overwrite: false, strict: true, multi: false, upsert: false, safe: true }
Mongoose: users.findOne({ _id: ObjectId("563b0410bd07ce2030eda26d") }) { fields: { password: 0 } }
</code></pre>
<p>Any clue?</p>
</div>
</div>
</div>
</div>
</div>
<div class="discussion-item discussion-item-ref">
<div class="discussion-item-header" id="ref-issue-115695084">
<span class="discussion-item-icon">
<span aria-hidden="true" class="octicon octicon-bookmark"></span>
</span>
<img alt="@vkarpov15" class="avatar" height="16" src="https://avatars2.githubusercontent.com/u/1620265?v=3&amp;s=32" width="16" />
<a href="http://github.com/vkarpov15" class="author" truncate="true">vkarpov15</a>

      referenced
      this issue
      <a class="timestamp" href="#ref-issue-115695084">
<time datetime="2015-11-07T21:54:38Z" is="relative-time">Nov 7, 2015</time>
</a>
</div>
<span class="state state-closed right">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
        Closed
      </span>
<h3 class="discussion-item-ref-title">
<a href="http://github.com/Automattic/mongoose/issues/3549" class="title-link">
        Pre update hook not updating field correctly
        <span class="issue-num">#3549</span>
</a> </h3>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/vkarpov15"><img alt="@vkarpov15" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/1620265?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154756753" class="comment previewable-edit timeline-comment js-comment js-task-list-container owner-comment" data-body-version="e9cd2ab783d094d351f499c69d29a76b">
<div class="timeline-comment-header ">
<span class="timeline-comment-label">Owner</span>
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/vkarpov15" class="author">vkarpov15</a>
</strong>

    commented

    <a href="#issuecomment-154756753" class="timestamp">
<time datetime="2015-11-07T21:54:50Z" is="relative-time">Nov 7, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p>Not sure, opened up a new issue to track.</p>
</div>
</div>
</div>
</div>
</div>
<div class="timeline-comment-wrapper js-comment-container">
<a href="http://github.com/willemmulder"><img alt="@willemmulder" class="timeline-comment-avatar" height="48" src="https://avatars1.githubusercontent.com/u/70933?v=3&amp;s=96" width="48" /></a>
<div id="issuecomment-154984300" class="comment previewable-edit timeline-comment js-comment js-task-list-container " data-body-version="b2e84bfb333d1b1fc7f0207153c7c6ae">
<div class="timeline-comment-header ">
<div class="timeline-comment-header-text">
<strong>
<a href="http://github.com/willemmulder" class="author">willemmulder</a>
</strong>

    commented

    <a href="#issuecomment-154984300" class="timestamp">
<time datetime="2015-11-09T07:37:39Z" is="relative-time">Nov 9, 2015</time>
</a>
</div>
</div>
<div class="comment-content">
<div class="edit-comment-hide">
<div class="comment-body markdown-body markdown-format js-comment-body">
<p><a href="https://github.com/vkarpov15" class="user-mention">@vkarpov15</a> Thanks, will track the other issue.</p>
</div>
</div>
</div>
</div>
</div>
<!-- Rendered timeline since 2015-11-18 01:15:20 -->
<div id="partial-timeline-marker" class="js-timeline-marker js-socket-channel js-updatable-content" data-channel="Automattic/mongoose:issue:5097952" data-url="/Automattic/mongoose/issues/964/show_partial?partial=issues%2Ftimeline_marker&amp;since=1447838120" data-last-modified="Wed, 18 Nov 2015 09:15:20 GMT">
<!-- &lt;/textarea&gt; --><!-- '"` --><form accept-charset="UTF-8" action="/Automattic/mongoose/notifications/mark?ids=539768" class="hidden js-timeline-marker-form" data-form-nonce="a5d0a6f6cb8a0541625d54de19acbf24e139efa0" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓" /><input name="authenticity_token" type="hidden" value="SwggETdF+rkoVFt9iDOCUGtA1c9G81umASkYqj02iozpj3FzD6iilsasmlJar9OAYFQKGp8uFOSXcd6+MJtV9w==" /></div>
</form></div>
</div>
<div class="discussion-timeline-actions">
<div class="signed-out-comment">
<a href="http://github.com/join?source=comment-repo" class="btn btn-primary" rel="nofollow">Sign up for free</a>
<strong>to join this conversation on GitHub</strong>.
    Already have an account?
    <a href="http://github.com/login?return_to=https%3A%2F%2Fgithub.com%2FAutomattic%2Fmongoose%2Fissues%2F964" rel="nofollow">Sign in to comment</a>
</div>
</div>
</div>
</div>
<div class="clear"></div>
</div>
</div>
</div>
<div class="modal-backdrop"></div>
</div>
</div>
</div>
</div>
<div class="container">
<div class="site-footer" role="contentinfo">
<ul class="site-footer-links right">
<li><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
<li><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
<li><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
<li><a href="https://shop.github.com" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
<li><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
<li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>
<li><a href="https://github.com/pricing" data-ga-click="Footer, go to pricing, text:pricing">Pricing</a></li>
</ul>
<a href="https://github.com" aria-label="Homepage">
<span aria-hidden="true" class="mega-octicon octicon-mark-github" title="GitHub "></span>
</a>
<ul class="site-footer-links">
<li>&copy; 2016 <span title="0.51653s from github-fe127-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
<li><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
<li><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
<li><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
<li><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact</a></li>
<li><a href="https://help.github.com" data-ga-click="Footer, go to help, text:help">Help</a></li>
</ul>
</div>
</div>
<div id="ajax-error-message" class="flash flash-error">
<span aria-hidden="true" class="octicon octicon-alert"></span>
<button type="button" class="flash-close js-flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
<span aria-hidden="true" class="octicon octicon-x"></span>
</button>
      Something went wrong with that request. Please try again.
    </div>
<script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/compat-a0cee5d8d4fb535c0f41971d037b32e852a56ddca5bf67bb2124e426a2d813a5.js"></script>
<script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/frameworks-9ee55ceaf87fc34dc86334249fef6cbece88e815478e0fbe81642d57ed0fff89.js"></script>
<script async="async" crossorigin="anonymous" src="https://assets-cdn.github.com/assets/github-8afeb971202f92778ffc73ddd92661c1977dc5e42a928ed35f8ec96e425a6e7a.js"></script>
<div class="js-stale-session-flash stale-session-flash flash flash-warn flash-banner hidden">
<span aria-hidden="true" class="octicon octicon-alert"></span>
<span class="signed-in-tab-flash">You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
<span class="signed-out-tab-flash">You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
</div>
<div class="facebox" id="facebox" style="display:none;">
<div class="facebox-popup">
<div class="facebox-content" role="dialog" aria-labelledby="facebox-header" aria-describedby="facebox-description">
</div>
<button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">
<span aria-hidden="true" class="octicon octicon-x"></span>
</button>
</div>
</div>
</body>
</html>
