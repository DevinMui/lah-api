
<!DOCTYPE html>
<html lang="en" class="">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8" />
<link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/github-d0dea0e5376d5c42aabf467726e0cffb7034a0d94eb947b9328eb6c9c4fcbba3.css" media="all" rel="stylesheet" />
<link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/github2-5f7255544b25f937224217b1c37ee5c139a0a00a3decd8020b9aabc550340903.css" media="all" rel="stylesheet" />
<link as="script" href="https://assets-cdn.github.com/assets/frameworks-9ee55ceaf87fc34dc86334249fef6cbece88e815478e0fbe81642d57ed0fff89.js" rel="preload" />
<link as="script" href="https://assets-cdn.github.com/assets/github-8afeb971202f92778ffc73ddd92661c1977dc5e42a928ed35f8ec96e425a6e7a.js" rel="preload" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Language" content="en" />
<meta name="viewport" content="width=1020" />
<title>Devise   CanCanCan   rolify Tutorial 路 RolifyCommunity/rolify Wiki 路 GitHub</title>
<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub" />
<link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
<link rel="apple-touch-icon" href="http://github.com/apple-touch-icon.png" />
<link rel="apple-touch-icon" sizes="57x57" href="http://github.com/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="http://github.com/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="http://github.com/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="http://github.com/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="http://github.com/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="http://github.com/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="http://github.com/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="http://github.com/apple-touch-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="http://github.com/apple-touch-icon-180x180.png" />
<meta property="fb:app_id" content="1401488693436528" />
<meta content="https://avatars1.githubusercontent.com/u/8007443?v=3&amp;s=400" name="twitter:image:src" /><meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="RolifyCommunity/rolify" name="twitter:title" /><meta content="rolify - Role management library with resource scoping" name="twitter:description" />
<meta content="https://avatars1.githubusercontent.com/u/8007443?v=3&amp;s=400" property="og:image" /><meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="RolifyCommunity/rolify" property="og:title" /><meta content="https://github.com/RolifyCommunity/rolify" property="og:url" /><meta content="rolify - Role management library with resource scoping" property="og:description" />
<meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats" />
<meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors" />
<link rel="assets" href="https://assets-cdn.github.com/" />
<meta name="pjax-timeout" content="1000" />
<meta name="msapplication-TileImage" content="/windows-tile.png" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="selected-link" value="repo_wiki" data-pjax-transient="data-pjax-transient" />
<meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" />
<meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA" />
<meta name="google-analytics" content="UA-3769691-2" />
<meta content="collector.githubapp.com" name="octolytics-host" /><meta content="github" name="octolytics-app-id" /><meta content="68C5BF7F:4962:719089E:56ADD466" name="octolytics-dimension-request_id" />
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location" />
<meta class="js-ga-set" name="dimension1" content="Logged Out" />
<meta name="hostname" content="github.com" />
<meta name="user-login" content="" />
<meta name="expected-hostname" content="github.com" />
<link rel="mask-icon" href="https://assets-cdn.github.com/pinned-octocat.svg" color="#4078c0" />
<link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico" />
<meta content="041f7cef536b72f4eff011bc2f07afa3f93d47e5" name="form-nonce" />
<meta http-equiv="x-pjax-version" content="55b41dd856d04e698e17bd7fc2020079" />
<meta name="description" content="rolify - Role management library with resource scoping" />
<meta name="go-import" content="github.com/RolifyCommunity/rolify git https://github.com/RolifyCommunity/rolify.git" />
<meta content="8007443" name="octolytics-dimension-user_id" /><meta content="RolifyCommunity" name="octolytics-dimension-user_login" /><meta content="1844503" name="octolytics-dimension-repository_id" /><meta content="RolifyCommunity/rolify" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="1844503" name="octolytics-dimension-repository_network_root_id" /><meta content="RolifyCommunity/rolify" name="octolytics-dimension-repository_network_root_nwo" />
<link href="https://github.com/RolifyCommunity/rolify/commits/master.atom" rel="alternate" title="Recent Commits to rolify:master" type="application/atom+xml" />
</head>
<body class="logged_out   env-production  vis-public">
<a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
<div class="header header-logged-out" role="banner">
<div class="container clearfix">
<a class="header-logo-wordmark" href="https://github.com/" data-ga-click="(Logged out) Header, go to homepage, icon:logo-wordmark">
<span aria-hidden="true" class="mega-octicon octicon-logo-github"></span>
</a>
<div class="header-actions" role="navigation">
<a class="btn btn-primary" href="http://github.com/join?source=header-repo" data-ga-click="(Logged out) Header, clicked Sign up, text:sign-up">Sign up</a>
<a class="btn" href="http://github.com/login?return_to=%2FRolifyCommunity%2Frolify%2Fwiki%2FDevise---CanCanCan---rolify-Tutorial" data-ga-click="(Logged out) Header, clicked Sign in, text:sign-in">Sign in</a>
</div>
<div class="site-search repo-scope js-site-search" role="search">
<!-- &lt;/textarea&gt; --><!-- '"` --><form accept-charset="UTF-8" action="/RolifyCommunity/rolify/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/RolifyCommunity/rolify/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓" /></div>
<label class="js-chromeless-input-container form-control">
<div class="scope-badge">This repository</div>
<input type="text" class="js-site-search-focus js-site-search-field is-clearable chromeless-input" data-hotkey="s" name="q" placeholder="Search" aria-label="Search this repository" data-global-scope-placeholder="Search GitHub" data-repo-scope-placeholder="Search" tabindex="1" autocapitalize="off" />
</label>
</form>
</div>
<ul class="header-nav left" role="navigation">
<li class="header-nav-item">
<a class="header-nav-link" href="http://github.com/explore" data-ga-click="(Logged out) Header, go to explore, text:explore">Explore</a>
</li>
<li class="header-nav-item">
<a class="header-nav-link" href="http://github.com/features" data-ga-click="(Logged out) Header, go to features, text:features">Features</a>
</li>
<li class="header-nav-item">
<a class="header-nav-link" href="https://enterprise.github.com/" data-ga-click="(Logged out) Header, go to enterprise, text:enterprise">Enterprise</a>
</li>
<li class="header-nav-item">
<a class="header-nav-link" href="http://github.com/pricing" data-ga-click="(Logged out) Header, go to pricing, text:pricing">Pricing</a>
</li>
</ul>
</div>
</div>
<div id="start-of-content" class="accessibility-aid"></div>
<div id="js-flash-container">
</div>
<div role="main" class="main-content">
<div itemscope="itemscope" itemtype="http://schema.org/WebPage">
<div id="js-repo-pjax-container" class="context-loader-container js-repo-nav-next" data-pjax-container="data-pjax-container">
<div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav">
<div class="container repohead-details-container">
<ul class="pagehead-actions">
<li>
<a href="http://github.com/login?return_to=%2FRolifyCommunity%2Frolify" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to watch a repository" rel="nofollow">
<span aria-hidden="true" class="octicon octicon-eye"></span>
    Watch
  </a>
<a class="social-count" href="http://github.com/RolifyCommunity/rolify/watchers">
    59
  </a>
</li>
<li>
<a href="http://github.com/login?return_to=%2FRolifyCommunity%2Frolify" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to star a repository" rel="nofollow">
<span aria-hidden="true" class="octicon octicon-star"></span>
    Star
  </a>
<a class="social-count js-social-count" href="http://github.com/RolifyCommunity/rolify/stargazers">
      1,663
    </a>
</li>
<li>
<a href="http://github.com/login?return_to=%2FRolifyCommunity%2Frolify" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to fork a repository" rel="nofollow">
<span aria-hidden="true" class="octicon octicon-repo-forked"></span>
        Fork
      </a>
<a href="http://github.com/RolifyCommunity/rolify/network" class="social-count">
      262
    </a>
</li>
</ul>
<h1 itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public ">
<span aria-hidden="true" class="octicon octicon-repo"></span>
<span class="author"><a href="http://github.com/RolifyCommunity" class="url fn" itemprop="url" rel="author"><span itemprop="title">RolifyCommunity</span></a></span><!--
--><span class="path-divider">/</span><!--
--><strong><a href="http://github.com/RolifyCommunity/rolify" data-pjax="#js-repo-pjax-container">rolify</a></strong>
<span class="page-context-loader">
<img alt="" height="16" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-32.gif" width="16" />
</span>
</h1>
</div>
<div class="container">
<nav class="reponav js-repo-nav js-sidenav-container-pjax js-octicon-loaders" role="navigation" data-pjax="#js-repo-pjax-container">
<a href="http://github.com/RolifyCommunity/rolify" aria-label="Code" class="js-selected-navigation-item reponav-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /RolifyCommunity/rolify">
<span aria-hidden="true" class="octicon octicon-code"></span>
    Code
</a>
<a href="http://github.com/RolifyCommunity/rolify/issues" class="js-selected-navigation-item reponav-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /RolifyCommunity/rolify/issues">
<span aria-hidden="true" class="octicon octicon-issue-opened"></span>
      Issues
      <span class="counter">63</span>
</a>
<a href="http://github.com/RolifyCommunity/rolify/pulls" class="js-selected-navigation-item reponav-item" data-hotkey="g p" data-selected-links="repo_pulls /RolifyCommunity/rolify/pulls">
<span aria-hidden="true" class="octicon octicon-git-pull-request"></span>
    Pull requests
    <span class="counter">8</span>
</a>
<a href="http://github.com/RolifyCommunity/rolify/wiki" aria-selected="true" class="js-selected-navigation-item selected reponav-item" data-hotkey="g w" data-selected-links="repo_wiki /RolifyCommunity/rolify/wiki">
<span aria-hidden="true" class="octicon octicon-book"></span>
      Wiki
</a>
<a href="http://github.com/RolifyCommunity/rolify/pulse" class="js-selected-navigation-item reponav-item" data-selected-links="pulse /RolifyCommunity/rolify/pulse">
<span aria-hidden="true" class="octicon octicon-pulse"></span>
    Pulse
</a>
<a href="http://github.com/RolifyCommunity/rolify/graphs" class="js-selected-navigation-item reponav-item" data-selected-links="repo_graphs repo_contributors /RolifyCommunity/rolify/graphs">
<span aria-hidden="true" class="octicon octicon-graph"></span>
    Graphs
</a>
</nav>
</div>
</div>
<div class="container new-discussion-timeline experiment-repo-nav">
<div class="repository-content">
<div id="wiki-wrapper" class="wiki-wrapper page">
<div class="gh-header">
<div class="gh-header-show">
<h1 class="gh-header-title instapaper_title">Devise   CanCanCan   rolify Tutorial</h1>
<div class="gh-header-meta">
        Valentine Rogers edited this page <time datetime="2015-09-28T15:32:46Z" is="relative-time">Sep 28, 2015</time>
        &middot;
        <a href="http://github.com/RolifyCommunity/rolify/wiki/Devise---CanCanCan---rolify-Tutorial/_history" class="history">
          4 revisions
        </a>
</div>
</div>
</div>
<div id="wiki-content">
<div class="has-rightbar">
<div id="wiki-rightbar">
<div class="wiki-pages-box readability-sidebar boxed-group flush js-wiki-pages-box " role="navigation">
<h3 class="js-wiki-toggle-collapse wiki-auxiliary-content">
<span aria-hidden="true" class="octicon octicon-triangle-down caret-expanded"></span>
<span aria-hidden="true" class="octicon octicon-triangle-right caret-collapsed"></span>
  Pages <span class="counter">9</span>
</h3>
<div class="boxed-group-inner wiki-auxiliary-content wiki-auxiliary-content-no-bg">
<ul class="wiki-pages" data-filterable-for="wiki-pages-filter" data-filterable-type="substring">
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki" class="wiki-page-link">Home</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/Configuration" class="wiki-page-link">Configuration</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/Devise---CanCanCan---rolify-Tutorial" class="wiki-page-link">Devise   CanCanCan   rolify Tutorial</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/FAQ" class="wiki-page-link">FAQ</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/Installation" class="wiki-page-link">Installation</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/rolify-3.2-and-older" class="wiki-page-link">rolify 3.2 and older</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/Rolify-with-Rails-fixtures" class="wiki-page-link">Rolify with Rails fixtures</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/Usage" class="wiki-page-link">Usage</a></strong>
</li>
<li>
<strong><a href="http://github.com/RolifyCommunity/rolify/wiki/Using-rolify-with-Devise-and-Authority" class="wiki-page-link">Using rolify with Devise and Authority</a></strong>
</li>
</ul>
</div>
</div>
<div class="clone-url">
<h5>Clone this wiki locally</h5>
<div class="input-group js-zeroclipboard-container">
<input type="text" class="input-mini text-small text-muted input-monospace js-url-field js-zeroclipboard-target" value="https://github.com/RolifyCommunity/rolify.wiki.git" readonly="readonly" />
<span class="input-group-button">
<button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><span aria-hidden="true" class="octicon octicon-clippy"></span></button>
</span>
</div>
</div>
</div>
<div id="wiki-body" class="gollum-markdown-content instapaper_body">
<div class="markdown-body">
<h1>
<a id="user-content-devise--cancancan--rolify-tutorial" class="anchor" href="#devise--cancancan--rolify-tutorial" aria-hidden="true"><span class="octicon octicon-link"></span></a>Devise + CanCanCan + rolify Tutorial</h1>
<p>This Tutorial shows you how to setup a <a href="http://rubyonrails.org/">Rails &gt;=3.1</a> application with a strong and flexible authentication/authorization stack using <a href="https://github.com/plataformatec/devise">Devise</a>, <a href="https://github.com/CanCanCommunity/cancancan">CanCanCan</a> and <a href="https://github.com/EppO/rolify">rolify</a> (3.0 and later)</p>
<h1>
<a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>
<p>First, create a bare new rails app. If you already have an existing app with Devise and CanCanCan set up and you just want to add rolify, just add rolify in your Gemfile, run <code>bundle install</code> and skip to step 5</p>
<ul>
<li><code># rails new rolify_tutorial</code></li>
<li>edit the <code>Gemfile</code> and add Devise, CanCanCan and rolify gems:</li>
</ul>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>devise<span class="pl-pds">'</span></span>
<span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>cancancan<span class="pl-pds">'</span></span>
<span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>rolify<span class="pl-pds">'</span></span></pre></div>
<ol>
<li><p>run <code>bundle install</code> to install all required gems</p></li>
<li>
<p>Run Devise generator</p>
<ul>
<li><code># rails generate devise:install</code></li>
</ul>
</li>
<li>
<p>Create the User model from Devise</p>
<ul>
<li><code># rails generate devise User</code></li>
</ul>
</li>
<li>
<p>Create the Ability class from CanCanCan</p>
<ul>
<li><code># rails generate cancan:ability</code></li>
</ul>
</li>
<li>
<p>Create the Role class from rolify</p>
<ul>
<li><code># rails generate rolify Role User</code></li>
</ul>
</li>
<li>
<p>Run migrations</p>
<ul>
<li><code># rake db:migrate</code></li>
</ul>
</li>
</ol>
<h1>
<a id="user-content-configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h1>
<ol>
<li><p>Configure Devise according to your needs. Follow <a href="https://github.com/plataformatec/devise/blob/master/README.md">Devise README</a> for details.</p></li>
<li><p>Edit the Ability model class, add these lines in the initialize method:</p></li>
</ol>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">if</span> user.has_role? <span class="pl-c1">:admin</span>
  can <span class="pl-c1">:manage</span>, <span class="pl-c1">:all</span>
<span class="pl-k">else</span>
  can <span class="pl-c1">:read</span>, <span class="pl-c1">:all</span>
<span class="pl-k">end</span></pre></div>
<ol>
<li>Use the resourcify method in all models you want to put a role on. For example, if we have the Forum model:</li>
</ol>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">Forum<span class="pl-e"> &lt; ActiveRecord::Base</span></span>
  resourcify
<span class="pl-k">end</span></pre></div>
<h1>
<a id="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>
<ol>
<li>Create a User using <code>rails console</code>
</li>
</ol>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">&gt;</span> user <span class="pl-k">=</span> <span class="pl-c1">User</span>.<span class="pl-k">new</span>
<span class="pl-k">&gt;</span> user.email <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>anyemail@address.com<span class="pl-pds">"</span></span>
<span class="pl-k">&gt;</span> user.password <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test1234<span class="pl-pds">"</span></span>
<span class="pl-k">&gt;</span> user.save</pre></div>
<ol>
<li>Add a role to the new User</li>
</ol>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">&gt;</span> user.add_role <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span></pre></div>
<ol>
<li>Check if the user has admin rights</li>
</ol>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">&gt;</span> ability <span class="pl-k">=</span> <span class="pl-c1">Ability</span>.<span class="pl-k">new</span>(user)
<span class="pl-k">&gt;</span> ability.can? <span class="pl-c1">:manage</span>, <span class="pl-c1">:all</span>
  =&gt; <span class="pl-c1">true</span></pre></div>
<h1>
<a id="user-content-advanced-usage" class="anchor" href="#advanced-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced Usage</h1>
<p>If you want to use class scoped role with CanCanCan, it's a bit tricky. Currently in CanCan 1.x, you cannot  mix instance and class checking, because the two are OR-ed and class checking skips the hash of conditions (see <a href="https://github.com/CanCanCommunity/cancancan/wiki/Checking-Abilities">https://github.com/CanCanCommunity/cancancan/wiki/Checking-Abilities</a> for more details). 
Let's take this ability class example:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">if</span> user.has_role? <span class="pl-c1">:admin</span>
  can <span class="pl-c1">:manage</span>, <span class="pl-c1">:all</span>
<span class="pl-k">else</span>
  can <span class="pl-c1">:read</span>, <span class="pl-c1">Forum</span>
  can <span class="pl-c1">:write</span>, <span class="pl-c1">Forum</span> <span class="pl-k">if</span> user.has_role?(<span class="pl-c1">:moderator</span>, <span class="pl-c1">Forum</span>)
  can <span class="pl-c1">:write</span>, <span class="pl-c1">Forum</span>, <span class="pl-c1">:id</span> =&gt; <span class="pl-c1">Forum</span>.with_role(<span class="pl-c1">:moderator</span>, user).pluck(<span class="pl-c1">:id</span>)
<span class="pl-k">end</span></pre></div>
<p>This <strong>won't</strong> work as you expect, because the last <code>:write</code> clause will always return <code>true</code> if you ask <code>ability.can? :write, Forum</code>, even if your user has only a role on an instance of Forum.
But you can use some workarounds: </p>
<ul>
<li>don't use the class scoped role for an instance. That means, you will need class scoped only roles and instance scoped only roles separated. In that case, it's better to use different action names like:</li>
</ul>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">if</span> user.has_role? <span class="pl-c1">:admin</span>
  can <span class="pl-c1">:manage</span>, <span class="pl-c1">:all</span>
<span class="pl-k">else</span>
  can <span class="pl-c1">:read</span>, <span class="pl-c1">Forum</span>
  can <span class="pl-c1">:manage</span>, <span class="pl-c1">Forum</span> <span class="pl-k">if</span> user.has_role?(<span class="pl-c1">:manager</span>, <span class="pl-c1">Forum</span>)
  can <span class="pl-c1">:write</span>, <span class="pl-c1">Forum</span>, <span class="pl-c1">:id</span> =&gt; <span class="pl-c1">Forum</span>.with_role(<span class="pl-c1">:moderator</span>, user).pluck(<span class="pl-c1">:id</span>)
<span class="pl-k">end</span></pre></div>
<ul>
<li>don't use <code>can?</code> method for class checking. Use rolify instead. so if you want to display a button or some info only if a user has a specific class role, use this:</li>
</ul>
<div class="highlight highlight-text-html-erb"><pre><span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">if</span> user.has_role? <span class="pl-c1">:moderator</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span>
  ...
<span class="pl-pse">&lt;%</span><span class="pl-s1"> <span class="pl-k">end</span> </span><span class="pl-pse"><span class="pl-s1">%</span>&gt;</span></pre></div>
<p>and for the instance scoped roles, you still are able to use the <code>Ability</code> class:</p>
<div class="highlight highlight-source-ruby"><pre><span class="pl-k">if</span> user.has_role? <span class="pl-c1">:admin</span>
  can <span class="pl-c1">:manage</span>, <span class="pl-c1">:all</span>
<span class="pl-k">else</span>
  can <span class="pl-c1">:read</span>, <span class="pl-c1">Forum</span>
  can <span class="pl-c1">:write</span>, <span class="pl-c1">Forum</span>, <span class="pl-c1">:id</span> =&gt; <span class="pl-c1">Forum</span>.with_role(<span class="pl-c1">:moderator</span>, user).pluck(<span class="pl-c1">:id</span>)
<span class="pl-k">end</span></pre></div>
<p>Please note that the <code>with_role</code> method allows us to restrict the Forum instances the user has a role on. It's provided by rolify library using <code>resourcify</code> method on the <code>Forum</code> class.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal-backdrop"></div>
</div>
</div>
</div>
</div>
<div class="container">
<div class="site-footer" role="contentinfo">
<ul class="site-footer-links right">
<li><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
<li><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
<li><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
<li><a href="https://shop.github.com" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
<li><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
<li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>
<li><a href="https://github.com/pricing" data-ga-click="Footer, go to pricing, text:pricing">Pricing</a></li>
</ul>
<a href="https://github.com" aria-label="Homepage">
<span aria-hidden="true" class="mega-octicon octicon-mark-github" title="GitHub "></span>
</a>
<ul class="site-footer-links">
<li>&copy; 2016 <span title="0.05102s from github-fe121-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
<li><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
<li><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
<li><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
<li><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact</a></li>
<li><a href="https://help.github.com" data-ga-click="Footer, go to help, text:help">Help</a></li>
</ul>
</div>
</div>
<div id="ajax-error-message" class="flash flash-error">
<span aria-hidden="true" class="octicon octicon-alert"></span>
<button type="button" class="flash-close js-flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
<span aria-hidden="true" class="octicon octicon-x"></span>
</button>
      Something went wrong with that request. Please try again.
    </div>
<script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/compat-a0cee5d8d4fb535c0f41971d037b32e852a56ddca5bf67bb2124e426a2d813a5.js"></script>
<script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/frameworks-9ee55ceaf87fc34dc86334249fef6cbece88e815478e0fbe81642d57ed0fff89.js"></script>
<script async="async" crossorigin="anonymous" src="https://assets-cdn.github.com/assets/github-8afeb971202f92778ffc73ddd92661c1977dc5e42a928ed35f8ec96e425a6e7a.js"></script>
<script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/wiki-479caef88e594edcef6697028bc6f669f6254cb027d57c894094eb9c8e52de25.js"></script>
<div class="js-stale-session-flash stale-session-flash flash flash-warn flash-banner hidden">
<span aria-hidden="true" class="octicon octicon-alert"></span>
<span class="signed-in-tab-flash">You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
<span class="signed-out-tab-flash">You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
</div>
<div class="facebox" id="facebox" style="display:none;">
<div class="facebox-popup">
<div class="facebox-content" role="dialog" aria-labelledby="facebox-header" aria-describedby="facebox-description">
</div>
<button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">
<span aria-hidden="true" class="octicon octicon-x"></span>
</button>
</div>
</div>
</body>
</html>
